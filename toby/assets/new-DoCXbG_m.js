import{r as v,_ as Re,e as Ce,f as Be,i as Ve,h as Xe,k as me,l as Ge,n as Ze,p as qe,o as Se,R as u,q as ae,t as Ye,m as ue,M as Ie,c as de,S as Te,v as Me,x as Fe,y as je,b as Ne,I as Qe,z as Ke,C as Je,A as ie,w as et,D as Y,a as tt,E as nt,j as C,B as ve,F as rt,G as it,s as D,T as Q}from"./index-DSfinKr5.js";import{b as A,c as ot,F as z,I as pe}from"./input-DphqC2dH.js";import{u as st}from"./index-xpH2Vq7I.js";import{A as at,G as ct,S as lt,u as ge}from"./dexie-react-hooks-DOEdUH__.js";import{T as be}from"./text-area-CxTWFkD8.js";import{F as ut}from"./FilterTag-DpzG2Alk.js";function dt(e){var t=v.useRef(0),n=Re(v.useState(e),2),r=n[0],i=n[1],o=v.useCallback(function(c){cancelAnimationFrame(t.current),t.current=requestAnimationFrame(function(){i(c)})},[]);return Ce(function(){cancelAnimationFrame(t.current)}),[r,o]}var $e=function(){if(typeof Map<"u")return Map;function e(t,n){var r=-1;return t.some(function(i,o){return i[0]===n?(r=o,!0):!1}),r}return function(){function t(){this.__entries__=[]}return Object.defineProperty(t.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),t.prototype.get=function(n){var r=e(this.__entries__,n),i=this.__entries__[r];return i&&i[1]},t.prototype.set=function(n,r){var i=e(this.__entries__,n);~i?this.__entries__[i][1]=r:this.__entries__.push([n,r])},t.prototype.delete=function(n){var r=this.__entries__,i=e(r,n);~i&&r.splice(i,1)},t.prototype.has=function(n){return!!~e(this.__entries__,n)},t.prototype.clear=function(){this.__entries__.splice(0)},t.prototype.forEach=function(n,r){r===void 0&&(r=null);for(var i=0,o=this.__entries__;i<o.length;i++){var c=o[i];n.call(r,c[1],c[0])}},t}()}(),ce=typeof window<"u"&&typeof document<"u"&&window.document===document,J=function(){return typeof global<"u"&&global.Math===Math?global:typeof self<"u"&&self.Math===Math?self:typeof window<"u"&&window.Math===Math?window:Function("return this")()}(),ft=function(){return typeof requestAnimationFrame=="function"?requestAnimationFrame.bind(J):function(e){return setTimeout(function(){return e(Date.now())},1e3/60)}}(),ht=2;function mt(e,t){var n=!1,r=!1,i=0;function o(){n&&(n=!1,e()),r&&m()}function c(){ft(o)}function m(){var s=Date.now();if(n){if(s-i<ht)return;r=!0}else n=!0,r=!1,setTimeout(c,t);i=s}return m}var vt=20,pt=["top","right","bottom","left","width","height","size","weight"],gt=typeof MutationObserver<"u",bt=function(){function e(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=mt(this.refresh.bind(this),vt)}return e.prototype.addObserver=function(t){~this.observers_.indexOf(t)||this.observers_.push(t),this.connected_||this.connect_()},e.prototype.removeObserver=function(t){var n=this.observers_,r=n.indexOf(t);~r&&n.splice(r,1),!n.length&&this.connected_&&this.disconnect_()},e.prototype.refresh=function(){var t=this.updateObservers_();t&&this.refresh()},e.prototype.updateObservers_=function(){var t=this.observers_.filter(function(n){return n.gatherActive(),n.hasActive()});return t.forEach(function(n){return n.broadcastActive()}),t.length>0},e.prototype.connect_=function(){!ce||this.connected_||(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),gt?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},e.prototype.disconnect_=function(){!ce||!this.connected_||(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},e.prototype.onTransitionEnd_=function(t){var n=t.propertyName,r=n===void 0?"":n,i=pt.some(function(o){return!!~r.indexOf(o)});i&&this.refresh()},e.getInstance=function(){return this.instance_||(this.instance_=new e),this.instance_},e.instance_=null,e}(),Ae=function(e,t){for(var n=0,r=Object.keys(t);n<r.length;n++){var i=r[n];Object.defineProperty(e,i,{value:t[i],enumerable:!1,writable:!1,configurable:!0})}return e},V=function(e){var t=e&&e.ownerDocument&&e.ownerDocument.defaultView;return t||J},ze=ne(0,0,0,0);function ee(e){return parseFloat(e)||0}function we(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return t.reduce(function(r,i){var o=e["border-"+i+"-width"];return r+ee(o)},0)}function wt(e){for(var t=["top","right","bottom","left"],n={},r=0,i=t;r<i.length;r++){var o=i[r],c=e["padding-"+o];n[o]=ee(c)}return n}function yt(e){var t=e.getBBox();return ne(0,0,t.width,t.height)}function _t(e){var t=e.clientWidth,n=e.clientHeight;if(!t&&!n)return ze;var r=V(e).getComputedStyle(e),i=wt(r),o=i.left+i.right,c=i.top+i.bottom,m=ee(r.width),s=ee(r.height);if(r.boxSizing==="border-box"&&(Math.round(m+o)!==t&&(m-=we(r,"left","right")+o),Math.round(s+c)!==n&&(s-=we(r,"top","bottom")+c)),!Et(e)){var d=Math.round(m+o)-t,l=Math.round(s+c)-n;Math.abs(d)!==1&&(m-=d),Math.abs(l)!==1&&(s-=l)}return ne(i.left,i.top,m,s)}var xt=function(){return typeof SVGGraphicsElement<"u"?function(e){return e instanceof V(e).SVGGraphicsElement}:function(e){return e instanceof V(e).SVGElement&&typeof e.getBBox=="function"}}();function Et(e){return e===V(e).document.documentElement}function Ot(e){return ce?xt(e)?yt(e):_t(e):ze}function Rt(e){var t=e.x,n=e.y,r=e.width,i=e.height,o=typeof DOMRectReadOnly<"u"?DOMRectReadOnly:Object,c=Object.create(o.prototype);return Ae(c,{x:t,y:n,width:r,height:i,top:n,right:t+r,bottom:i+n,left:t}),c}function ne(e,t,n,r){return{x:e,y:t,width:n,height:r}}var Ct=function(){function e(t){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=ne(0,0,0,0),this.target=t}return e.prototype.isActive=function(){var t=Ot(this.target);return this.contentRect_=t,t.width!==this.broadcastWidth||t.height!==this.broadcastHeight},e.prototype.broadcastRect=function(){var t=this.contentRect_;return this.broadcastWidth=t.width,this.broadcastHeight=t.height,t},e}(),St=function(){function e(t,n){var r=Rt(n);Ae(this,{target:t,contentRect:r})}return e}(),It=function(){function e(t,n,r){if(this.activeObservations_=[],this.observations_=new $e,typeof t!="function")throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=t,this.controller_=n,this.callbackCtx_=r}return e.prototype.observe=function(t){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(!(typeof Element>"u"||!(Element instanceof Object))){if(!(t instanceof V(t).Element))throw new TypeError('parameter 1 is not of type "Element".');var n=this.observations_;n.has(t)||(n.set(t,new Ct(t)),this.controller_.addObserver(this),this.controller_.refresh())}},e.prototype.unobserve=function(t){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(!(typeof Element>"u"||!(Element instanceof Object))){if(!(t instanceof V(t).Element))throw new TypeError('parameter 1 is not of type "Element".');var n=this.observations_;n.has(t)&&(n.delete(t),n.size||this.controller_.removeObserver(this))}},e.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},e.prototype.gatherActive=function(){var t=this;this.clearActive(),this.observations_.forEach(function(n){n.isActive()&&t.activeObservations_.push(n)})},e.prototype.broadcastActive=function(){if(this.hasActive()){var t=this.callbackCtx_,n=this.activeObservations_.map(function(r){return new St(r.target,r.broadcastRect())});this.callback_.call(t,n,t),this.clearActive()}},e.prototype.clearActive=function(){this.activeObservations_.splice(0)},e.prototype.hasActive=function(){return this.activeObservations_.length>0},e}(),Pe=typeof WeakMap<"u"?new WeakMap:new $e,Le=function(){function e(t){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var n=bt.getInstance(),r=new It(t,n,this);Pe.set(this,r)}return e}();["observe","unobserve","disconnect"].forEach(function(e){Le.prototype[e]=function(){var t;return(t=Pe.get(this))[e].apply(t,arguments)}});var Tt=function(){return typeof J.ResizeObserver<"u"?J.ResizeObserver:Le}(),Mt=Be(v.useLayoutEffect),Ft=Ve?Mt:Xe;function le(e){var t=Re(dt(function(){var i=me(e);return i?{width:i.clientWidth,height:i.clientHeight}:void 0}),2),n=t[0],r=t[1];return Ft(function(){var i=me(e);if(i){var o=new Tt(function(c){c.forEach(function(m){var s=m.target,d=s.clientWidth,l=s.clientHeight;r({width:d,height:l})})});return o.observe(i),function(){o.disconnect()}}},[],e),n}function ye(e,t,n){return e*t*n/(t+n*e)}function _e(e,t,n,r,i=.15){return i===0?A(e,t,n):e<t?-ye(t-e,r,i)+t:e>n?+ye(e-n,r,i)+n:e}function jt(e){if(e==null||e==="")return 0;const t=e.trim();return t.endsWith("px")?parseFloat(t):t.endsWith("rem")?parseFloat(t)*parseFloat(window.getComputedStyle(document.documentElement).fontSize):t.endsWith("vw")?parseFloat(t)*window.innerWidth/100:0}const Nt=Ge([Ze,qe]),K=()=>[1,0,0,1,0,0],xe=e=>e[4],Ee=e=>e[5],Z=e=>e[0],q=(e,t,n)=>Ue([1,0,0,1,t,n],e),$t=(e,t,n=t)=>Ue([t,0,0,n,0,0],e),At=(e,[t,n])=>[e[0]*t+e[2]*n+e[4],e[1]*t+e[3]*n+e[5]],Ue=(e,t)=>[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]],oe="adm-image-viewer",De=e=>{const{dragLockRef:t,maxZoom:n}=e,r=v.useRef([]),i=v.useRef(null),o=v.useRef(null),[{matrix:c},m]=Se(()=>({matrix:K(),config:{tension:200}})),s=le(i),d=le(o),l=v.useRef(!1),h=a=>{if(!s||!d)return{x:{position:0,minX:0,maxX:0},y:{position:0,minY:0,maxY:0}};const E=-s.width/2,O=-s.height/2,p=-d.width/2,y=-d.height/2,_=Z(a),S=_*d.width,T=_*d.height,F=E-(S-s.width),b=E,P=O-(T-s.height),L=O,[N,$]=At(a,[p,y]);return{x:{position:N,minX:F,maxX:b},y:{position:$,minY:P,maxY:L}}},w=(a,E,O,p=0)=>[a<=E-p,a>=O+p],M=(a,E,O=!1)=>{if(!s||!d)return a;const p=Z(a),y=p*d.width,_=p*d.height,{x:{position:S,minX:T,maxX:F},y:{position:b,minY:P,maxY:L}}=h(a);if(E==="translate"){let N=S,$=b;return y>s.width?N=O?A(S,T,F):_e(S,T,F,p*50):N=-y/2,_>s.height?$=O?A(b,P,L):_e(b,P,L,p*50):$=-_/2,q(a,N-S,$-b)}if(E==="scale"&&O){const[N,$]=[y>s.width?A(S,T,F):-y/2,_>s.height?A(b,P,L):-_/2];return q(a,N-S,$-b)}return a};return Nt({onDrag:a=>{var E;if(a.first){const{x:{position:p,minX:y,maxX:_}}=h(c.get());r.current=w(p,y,_);return}if(a.pinching)return a.cancel();if(a.tap&&a.elapsedTime>0&&a.elapsedTime<1e3){(E=e.onTap)===null||E===void 0||E.call(e);return}const O=Z(c.get());if(t&&(t.current=O!==1),!l.current&&O<=1)m.start({matrix:K()});else{const p=c.get(),y=[a.offset[0]-xe(p),a.offset[1]-Ee(p)],_=q(p,...a.last?[y[0]+a.velocity[0]*a.direction[0]*200,y[1]+a.velocity[1]*a.direction[1]*200]:y);m.start({matrix:M(_,"translate",a.last),immediate:!a.last});const{x:{position:S,minX:T,maxX:F}}=h(_);a.last&&r.current.some(b=>b)&&w(S,T,F).some(b=>b)&&(t&&(t.current=!1),m.start({matrix:K()}))}},onPinch:a=>{var E;l.current=!a.last;const[O]=a.offset;if(O<0)return;let p;n==="auto"?p=s&&d?Math.max(s.height/d.height,s.width/d.width):1:p=n;const y=a.last?A(O,1,p):O;if((E=e.onZoomChange)===null||E===void 0||E.call(e,y),a.last&&y<=1)m.start({matrix:K()}),t&&(t.current=!1);else{if(!s)return;const _=c.get(),S=Z(_),T=a.origin[0]-s.width/2,F=a.origin[1]-s.height/2;let b=q(_,-T,-F);b=$t(b,y/S),b=q(b,T,F),m.start({matrix:M(b,"scale",a.last),immediate:!a.last}),t&&(t.current=!0)}}},{target:i,drag:{from:()=>[xe(c.get()),Ee(c.get())],pointer:{touch:!0}},pinch:{from:()=>[Z(c.get()),0],pointer:{touch:!0}}}),u.createElement("div",{className:`${oe}-slide`},u.createElement("div",{className:`${oe}-control`,ref:i},u.createElement(ae.div,{className:`${oe}-image-wrapper`,style:{matrix:c}},u.createElement("img",{ref:o,src:e.image,draggable:!1,alt:e.image}))))},se="adm-image-viewer",zt=v.forwardRef((e,t)=>{const n=window.innerWidth+ot(16),[{x:r},i]=Se(()=>({x:e.defaultIndex*n,config:{tension:250,clamp:!0}})),o=e.images.length;function c(d,l=!1){var h;const w=A(d,0,o-1);(h=e.onIndexChange)===null||h===void 0||h.call(e,w),i.start({x:w*n,immediate:l})}v.useImperativeHandle(t,()=>({swipeTo:c}));const m=v.useRef(!1),s=Ye(d=>{if(m.current)return;const[l]=d.offset;if(d.last){const h=Math.floor(l/n),w=h+1,M=Math.min(d.velocity[0]*2e3,n)*d.direction[0];c(A(Math.round((l+M)/n),h,w))}else i.start({x:l,immediate:!0})},{transform:([d,l])=>[-d,l],from:()=>[r.get(),0],bounds:()=>({left:0,right:(o-1)*n}),rubberband:!0,axis:"x",pointer:{touch:!0}});return u.createElement("div",Object.assign({className:`${se}-slides`},s()),u.createElement(ae.div,{className:`${se}-indicator`},r.to(d=>`${A(Math.round(d/n),0,o-1)+1} / ${o}`)),u.createElement(ae.div,{className:`${se}-slides-inner`,style:{x:r.to(d=>-d)}},e.images.map((d,l)=>u.createElement(De,{key:l,image:d,onTap:e.onTap,maxZoom:e.maxZoom,onZoomChange:h=>{if(h!==1){const w=Math.round(r.get()/n);i.start({x:w*n})}},dragLockRef:m}))))}),te="adm-image-viewer",ke={maxZoom:3,getContainer:null,visible:!1},We=e=>{var t,n,r;const i=ue(ke,e),o=u.createElement(Ie,{visible:i.visible,disableBodyScroll:!1,opacity:"thick",afterClose:i.afterClose,destroyOnClose:!0,className:(t=i==null?void 0:i.classNames)===null||t===void 0?void 0:t.mask},u.createElement("div",{className:de(`${te}-content`,(n=i==null?void 0:i.classNames)===null||n===void 0?void 0:n.body)},i.image&&u.createElement(De,{image:i.image,onTap:i.onClose,maxZoom:i.maxZoom})),i.image&&u.createElement("div",{className:`${te}-footer`},(r=i.renderFooter)===null||r===void 0?void 0:r.call(i,i.image),u.createElement(Te,{position:"bottom"})));return Me(i.getContainer,o)},Pt=Object.assign(Object.assign({},ke),{defaultIndex:0}),He=v.forwardRef((e,t)=>{var n,r,i;const o=ue(Pt,e),[c,m]=v.useState(o.defaultIndex),s=v.useRef(null);v.useImperativeHandle(t,()=>({swipeTo:(h,w)=>{var M;m(h),(M=s.current)===null||M===void 0||M.swipeTo(h,w)}}));const d=v.useCallback(h=>{var w;h!==c&&(m(h),(w=o.onIndexChange)===null||w===void 0||w.call(o,h))},[o.onIndexChange,c]),l=u.createElement(Ie,{visible:o.visible,disableBodyScroll:!1,opacity:"thick",afterClose:o.afterClose,destroyOnClose:!0,className:(n=o==null?void 0:o.classNames)===null||n===void 0?void 0:n.mask},u.createElement("div",{className:de(`${te}-content`,(r=o==null?void 0:o.classNames)===null||r===void 0?void 0:r.body)},o.images&&u.createElement(zt,{ref:s,defaultIndex:c,onIndexChange:d,images:o.images,onTap:o.onClose,maxZoom:o.maxZoom})),o.images&&u.createElement("div",{className:`${te}-footer`},(i=o.renderFooter)===null||i===void 0?void 0:i.call(o,o.images[c],c),u.createElement(Te,{position:"bottom"})));return Me(o.getContainer,l)}),X=new Set;function Lt(e){fe();const t=Fe(u.createElement(We,Object.assign({},e,{afterClose:()=>{var n;X.delete(t),(n=e.afterClose)===null||n===void 0||n.call(e)}})));return X.add(t),t}function Ut(e){fe();const t=Fe(u.createElement(He,Object.assign({},e,{afterClose:()=>{var n;X.delete(t),(n=e.afterClose)===null||n===void 0||n.call(e)}})));return X.add(t),t}function fe(){X.forEach(e=>{e.close()}),X.clear()}const Dt=je(He,{show:Ut}),kt=je(We,{Multi:Dt,show:Lt,clear:fe}),k="adm-image-uploader",Oe=e=>{const{locale:t}=Ne(),{url:n,file:r,deletable:i,deleteIcon:o,onDelete:c,imageFit:m}=e,s=v.useMemo(()=>n||(r?URL.createObjectURL(r):""),[n,r]);v.useEffect(()=>()=>{r&&URL.revokeObjectURL(s)},[s,r]);function d(){return e.status==="pending"&&u.createElement("div",{className:`${k}-cell-mask`},u.createElement("span",{className:`${k}-cell-loading`},u.createElement(Ke,{color:"white"}),u.createElement("span",{className:`${k}-cell-mask-message`},t.ImageUploader.uploading)))}function l(){return i&&u.createElement("span",{className:`${k}-cell-delete`,onClick:c},o)}return u.createElement("div",{className:de(`${k}-cell`,e.status==="fail"&&`${k}-cell-fail`)},u.createElement(Qe,{className:`${k}-cell-image`,src:s,fit:m,onClick:e.onClick}),d(),l())},j="adm-image-uploader",Wt={disableUpload:!1,deletable:!0,deleteIcon:u.createElement(Je,{className:`${j}-cell-delete-icon`}),showUpload:!0,multiple:!1,maxCount:0,defaultValue:[],accept:"image/*",preview:!0,showFailed:!0,imageFit:"cover"},Ht=v.forwardRef((e,t)=>{const{locale:n}=Ne(),r=ue(Wt,e),{columns:i}=r,[o,c]=st(r),[m,s]=v.useState([]),d=v.useRef(null),l=le(d),h=v.useRef(null),[w,M]=v.useState(80),a=v.useRef(null);ie(()=>{const f=h.current;if(i&&l&&f){const g=l.width,I=jt(window.getComputedStyle(f).getPropertyValue("height"));M((g-I*(i-1))/i)}},[l==null?void 0:l.width]);const E={"--cell-size":w+"px"};ie(()=>{s(f=>f.filter(g=>g.url===void 0?!0:!o.some(I=>I.url===g.url)))},[o]),ie(()=>{var f;(f=r.onUploadQueueChange)===null||f===void 0||f.call(r,m.map(g=>({id:g.id,status:g.status})))},[m]);const O=v.useRef(0),{maxCount:p,onPreview:y,renderItem:_}=r;function S(f,g){return Y(this,void 0,void 0,function*(){const{beforeUpload:I}=r;let R=f;return R=yield I==null?void 0:I(f,g),R})}function T(f){return r.showFailed?f:f.filter(g=>g.status!=="fail")}function F(f){var g;return Y(this,void 0,void 0,function*(){f.persist();const{files:I}=f.target;if(!I)return;let R=[].slice.call(I);if(f.target.value="",r.beforeUpload){const x=R.map(H=>S(H,R));yield Promise.all(x).then(H=>{R=H.filter(Boolean)})}if(R.length===0)return;if(p>0){const x=o.length+R.length-p;x>0&&(R=R.slice(0,R.length-x),(g=r.onCountExceed)===null||g===void 0||g.call(r,x))}const G=R.map(x=>({id:O.current++,status:"pending",file:x}));s(x=>[...T(x),...G]);const W=[];yield Promise.all(G.map((x,H)=>Y(this,void 0,void 0,function*(){try{const B=yield r.upload(x.file);W[H]=B,s(re=>re.map(U=>U.id===x.id?Object.assign(Object.assign({},U),{status:"success",url:B.url}):U))}catch(B){throw s(re=>re.map(U=>U.id===x.id?Object.assign(Object.assign({},U),{status:"fail"}):U)),B}}))).catch(x=>console.error(x)),c(x=>x.concat(W))})}const b=v.useRef(null);function P(f){b.current=kt.Multi.show({images:o.map(g=>g.url),defaultIndex:f,onClose:()=>{b.current=null}})}Ce(()=>{var f;(f=b.current)===null||f===void 0||f.close()});const L=T(m),N=r.showUpload&&(p===0||o.length+L.length<p),$=()=>o.map((f,g)=>{var I,R;const G=u.createElement(Oe,{key:(I=f.key)!==null&&I!==void 0?I:g,url:(R=f.thumbnailUrl)!==null&&R!==void 0?R:f.url,deletable:r.deletable,deleteIcon:r.deleteIcon,imageFit:r.imageFit,onClick:()=>{r.preview&&P(g),y&&y(g,f)},onDelete:()=>Y(void 0,void 0,void 0,function*(){var W;(yield(W=r.onDelete)===null||W===void 0?void 0:W.call(r,f))!==!1&&c(o.filter((H,B)=>B!==g))})});return _?_(G,f,o):G}),he=u.createElement(u.Fragment,null,$(),m.map(f=>!r.showFailed&&f.status==="fail"?null:u.createElement(Oe,{key:f.id,file:f.file,deletable:f.status!=="pending",deleteIcon:r.deleteIcon,status:f.status,imageFit:r.imageFit,onDelete:()=>{s(m.filter(g=>g.id!==f.id))}})),u.createElement("div",{className:`${j}-upload-button-wrap`,style:N?void 0:{display:"none"}},r.children||u.createElement("span",{className:`${j}-cell ${j}-upload-button`,role:"button","aria-label":n.ImageUploader.upload},u.createElement("span",{className:`${j}-upload-button-icon`},u.createElement(at,null))),!r.disableUpload&&u.createElement("input",{ref:a,capture:r.capture,accept:r.accept,multiple:r.multiple,type:"file",className:`${j}-input`,onChange:F,"aria-hidden":!0})));return v.useImperativeHandle(t,()=>({get nativeElement(){return a.current}})),et(r,u.createElement("div",{className:j,ref:d},i?u.createElement(ct,{className:`${j}-grid`,columns:i,style:E},u.createElement("div",{className:`${j}-gap-measure`,ref:h}),he.props.children):u.createElement(lt,{className:`${j}-space`,wrap:!0,block:!0},he.props.children)))}),Bt=async e=>{const t=new TextEncoder().encode(e),n=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(n)).map(o=>o.toString(16).padStart(2,"0")).join("")},Qt=()=>{const e=tt(),{id:t}=nt(),n=ge(()=>D.db.web.orderBy("order").last().then(l=>((l==null?void 0:l.order)||0)+1),[],0),r=ge(async()=>await D.db.web.orderBy("url").keys(),[],[]),[i]=z.useForm(),[o,c]=v.useState(),[m,s]=v.useState(!1);v.useEffect(()=>{(async()=>{if(!t){n&&c({order:n});return}const h=await D.db.web.get(+t);if(console.log("res",h),!h){e(-1);return}c(h)})()},[n,t,e]);const d=async l=>{s(!0),t?await D.db.web.update(+t,{...l,hostname:new URL(l.url).hostname,order:+l.order}).then(()=>{Q.show({icon:"success",content:"编辑成功!"}),i.resetFields(),e(-1)}).catch(h=>{Q.show({icon:"fail",content:h.message})}):await D.db.web.add({...l,hostname:new URL(l.url).hostname,order:+l.order}).then(()=>{Q.show({icon:"success",content:"新建成功!"}),i.resetFields(),e(-1)}).catch(h=>{Q.show({icon:"fail",content:h.message})}),s(!1)};return C.jsx("div",{children:o&&C.jsxs(z,{name:"form",form:i,onFinish:d,initialValues:o,footer:C.jsx(ve,{block:!0,type:"submit",color:"primary",loading:m,children:"提交"}),children:[C.jsx(z.Item,{name:"title",label:"名称",rules:[{required:!0}],children:C.jsx(pe,{placeholder:"请输入名称"})}),C.jsx(z.Item,{name:"desc",label:"描述",children:C.jsx(be,{placeholder:"请输入描述",autoSize:!0})}),C.jsx(z.Item,{name:"url",label:"地址",validateFirst:!0,rules:[{required:!0},{validator:(l,h)=>{try{new URL(h)}catch{return Promise.reject(new Error("url格式错误!"))}return!t&&r.includes(h)?Promise.reject(new Error("url不能重复!")):Promise.resolve()}}],children:C.jsx(be,{placeholder:"请输入地址",autoSize:!0})}),C.jsx(z.Item,{name:"icon",label:"icon",children:C.jsx(Ht,{multiple:!0,maxCount:1,upload:async l=>{const h=URL.createObjectURL(l),w=await rt(h),M=await Bt(w),a=await it(M,w);return a.success?{url:a.data}:Promise.reject()}})}),C.jsx(z.Item,{name:"tags",label:"标签",children:C.jsx(ut,{webConfig:D})}),C.jsx(z.Item,{name:"order",label:"排序",rules:[{required:!0}],children:C.jsx(pe,{type:"number",placeholder:"请输入排序"})}),C.jsx(ve,{className:"ml-4 mb-2",size:"small",color:"primary",onClick:()=>{e(`${D.path}/tag`)},children:"新增"})]})})};export{Qt as default};
