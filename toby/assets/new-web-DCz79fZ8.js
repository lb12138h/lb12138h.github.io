import{r as m,_ as Oe,i as He,c as Ve,d as Be,p as Xe,b as Re,R as l,e as oe,f as Ze,m as ce,M as Ce,h as le,S as Se,k as Ie,n as Te,o as Me,q as je,s as Ge,C as qe,t as ne,w as Ye,v as q,a as Qe,j as C,x as Ke,y as Je,T as fe}from"./index-DTRIon_s.js";import{u as Fe,c as et,a as tt,g as he,b as A,d as nt,F as z,B as me,I as ve}from"./input-xzuf9X7x.js";import{I as rt,T as pe}from"./text-area-YAf5VYHQ.js";import{u as it}from"./index-C7hdw2RV.js";import{A as ot,G as st,S as at,u as ge}from"./dexie-react-hooks-DvDLujsZ.js";import{F as ct}from"./FilterTag-BzcASIf4.js";import{u as lt}from"./useWebConfig-By0D1mtS.js";function ut(e){var t=m.useRef(0),n=Oe(m.useState(e),2),r=n[0],i=n[1],o=m.useCallback(function(c){cancelAnimationFrame(t.current),t.current=requestAnimationFrame(function(){i(c)})},[]);return Fe(function(){cancelAnimationFrame(t.current)}),[r,o]}var Ne=function(){if(typeof Map<"u")return Map;function e(t,n){var r=-1;return t.some(function(i,o){return i[0]===n?(r=o,!0):!1}),r}return function(){function t(){this.__entries__=[]}return Object.defineProperty(t.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),t.prototype.get=function(n){var r=e(this.__entries__,n),i=this.__entries__[r];return i&&i[1]},t.prototype.set=function(n,r){var i=e(this.__entries__,n);~i?this.__entries__[i][1]=r:this.__entries__.push([n,r])},t.prototype.delete=function(n){var r=this.__entries__,i=e(r,n);~i&&r.splice(i,1)},t.prototype.has=function(n){return!!~e(this.__entries__,n)},t.prototype.clear=function(){this.__entries__.splice(0)},t.prototype.forEach=function(n,r){r===void 0&&(r=null);for(var i=0,o=this.__entries__;i<o.length;i++){var c=o[i];n.call(r,c[1],c[0])}},t}()}(),se=typeof window<"u"&&typeof document<"u"&&window.document===document,Q=function(){return typeof global<"u"&&global.Math===Math?global:typeof self<"u"&&self.Math===Math?self:typeof window<"u"&&window.Math===Math?window:Function("return this")()}(),dt=function(){return typeof requestAnimationFrame=="function"?requestAnimationFrame.bind(Q):function(e){return setTimeout(function(){return e(Date.now())},1e3/60)}}(),ft=2;function ht(e,t){var n=!1,r=!1,i=0;function o(){n&&(n=!1,e()),r&&h()}function c(){dt(o)}function h(){var s=Date.now();if(n){if(s-i<ft)return;r=!0}else n=!0,r=!1,setTimeout(c,t);i=s}return h}var mt=20,vt=["top","right","bottom","left","width","height","size","weight"],pt=typeof MutationObserver<"u",gt=function(){function e(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=ht(this.refresh.bind(this),mt)}return e.prototype.addObserver=function(t){~this.observers_.indexOf(t)||this.observers_.push(t),this.connected_||this.connect_()},e.prototype.removeObserver=function(t){var n=this.observers_,r=n.indexOf(t);~r&&n.splice(r,1),!n.length&&this.connected_&&this.disconnect_()},e.prototype.refresh=function(){var t=this.updateObservers_();t&&this.refresh()},e.prototype.updateObservers_=function(){var t=this.observers_.filter(function(n){return n.gatherActive(),n.hasActive()});return t.forEach(function(n){return n.broadcastActive()}),t.length>0},e.prototype.connect_=function(){!se||this.connected_||(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),pt?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},e.prototype.disconnect_=function(){!se||!this.connected_||(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},e.prototype.onTransitionEnd_=function(t){var n=t.propertyName,r=n===void 0?"":n,i=vt.some(function(o){return!!~r.indexOf(o)});i&&this.refresh()},e.getInstance=function(){return this.instance_||(this.instance_=new e),this.instance_},e.instance_=null,e}(),$e=function(e,t){for(var n=0,r=Object.keys(t);n<r.length;n++){var i=r[n];Object.defineProperty(e,i,{value:t[i],enumerable:!1,writable:!1,configurable:!0})}return e},V=function(e){var t=e&&e.ownerDocument&&e.ownerDocument.defaultView;return t||Q},Ae=ee(0,0,0,0);function K(e){return parseFloat(e)||0}function be(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return t.reduce(function(r,i){var o=e["border-"+i+"-width"];return r+K(o)},0)}function bt(e){for(var t=["top","right","bottom","left"],n={},r=0,i=t;r<i.length;r++){var o=i[r],c=e["padding-"+o];n[o]=K(c)}return n}function wt(e){var t=e.getBBox();return ee(0,0,t.width,t.height)}function yt(e){var t=e.clientWidth,n=e.clientHeight;if(!t&&!n)return Ae;var r=V(e).getComputedStyle(e),i=bt(r),o=i.left+i.right,c=i.top+i.bottom,h=K(r.width),s=K(r.height);if(r.boxSizing==="border-box"&&(Math.round(h+o)!==t&&(h-=be(r,"left","right")+o),Math.round(s+c)!==n&&(s-=be(r,"top","bottom")+c)),!xt(e)){var u=Math.round(h+o)-t,d=Math.round(s+c)-n;Math.abs(u)!==1&&(h-=u),Math.abs(d)!==1&&(s-=d)}return ee(i.left,i.top,h,s)}var _t=function(){return typeof SVGGraphicsElement<"u"?function(e){return e instanceof V(e).SVGGraphicsElement}:function(e){return e instanceof V(e).SVGElement&&typeof e.getBBox=="function"}}();function xt(e){return e===V(e).document.documentElement}function Et(e){return se?_t(e)?wt(e):yt(e):Ae}function Ot(e){var t=e.x,n=e.y,r=e.width,i=e.height,o=typeof DOMRectReadOnly<"u"?DOMRectReadOnly:Object,c=Object.create(o.prototype);return $e(c,{x:t,y:n,width:r,height:i,top:n,right:t+r,bottom:i+n,left:t}),c}function ee(e,t,n,r){return{x:e,y:t,width:n,height:r}}var Rt=function(){function e(t){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=ee(0,0,0,0),this.target=t}return e.prototype.isActive=function(){var t=Et(this.target);return this.contentRect_=t,t.width!==this.broadcastWidth||t.height!==this.broadcastHeight},e.prototype.broadcastRect=function(){var t=this.contentRect_;return this.broadcastWidth=t.width,this.broadcastHeight=t.height,t},e}(),Ct=function(){function e(t,n){var r=Ot(n);$e(this,{target:t,contentRect:r})}return e}(),St=function(){function e(t,n,r){if(this.activeObservations_=[],this.observations_=new Ne,typeof t!="function")throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=t,this.controller_=n,this.callbackCtx_=r}return e.prototype.observe=function(t){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(!(typeof Element>"u"||!(Element instanceof Object))){if(!(t instanceof V(t).Element))throw new TypeError('parameter 1 is not of type "Element".');var n=this.observations_;n.has(t)||(n.set(t,new Rt(t)),this.controller_.addObserver(this),this.controller_.refresh())}},e.prototype.unobserve=function(t){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(!(typeof Element>"u"||!(Element instanceof Object))){if(!(t instanceof V(t).Element))throw new TypeError('parameter 1 is not of type "Element".');var n=this.observations_;n.has(t)&&(n.delete(t),n.size||this.controller_.removeObserver(this))}},e.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},e.prototype.gatherActive=function(){var t=this;this.clearActive(),this.observations_.forEach(function(n){n.isActive()&&t.activeObservations_.push(n)})},e.prototype.broadcastActive=function(){if(this.hasActive()){var t=this.callbackCtx_,n=this.activeObservations_.map(function(r){return new Ct(r.target,r.broadcastRect())});this.callback_.call(t,n,t),this.clearActive()}},e.prototype.clearActive=function(){this.activeObservations_.splice(0)},e.prototype.hasActive=function(){return this.activeObservations_.length>0},e}(),ze=typeof WeakMap<"u"?new WeakMap:new Ne,Pe=function(){function e(t){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var n=gt.getInstance(),r=new St(t,n,this);ze.set(this,r)}return e}();["observe","unobserve","disconnect"].forEach(function(e){Pe.prototype[e]=function(){var t;return(t=ze.get(this))[e].apply(t,arguments)}});var It=function(){return typeof Q.ResizeObserver<"u"?Q.ResizeObserver:Pe}(),Tt=et(m.useLayoutEffect),Mt=He?Tt:tt;function ae(e){var t=Oe(ut(function(){var i=he(e);return i?{width:i.clientWidth,height:i.clientHeight}:void 0}),2),n=t[0],r=t[1];return Mt(function(){var i=he(e);if(i){var o=new It(function(c){c.forEach(function(h){var s=h.target,u=s.clientWidth,d=s.clientHeight;r({width:u,height:d})})});return o.observe(i),function(){o.disconnect()}}},[],e),n}function we(e,t,n){return e*t*n/(t+n*e)}function ye(e,t,n,r,i=.15){return i===0?A(e,t,n):e<t?-we(t-e,r,i)+t:e>n?+we(e-n,r,i)+n:e}function jt(e){if(e==null||e==="")return 0;const t=e.trim();return t.endsWith("px")?parseFloat(t):t.endsWith("rem")?parseFloat(t)*parseFloat(window.getComputedStyle(document.documentElement).fontSize):t.endsWith("vw")?parseFloat(t)*window.innerWidth/100:0}const Ft=Ve([Be,Xe]),Y=()=>[1,0,0,1,0,0],_e=e=>e[4],xe=e=>e[5],Z=e=>e[0],G=(e,t,n)=>Le([1,0,0,1,t,n],e),Nt=(e,t,n=t)=>Le([t,0,0,n,0,0],e),$t=(e,[t,n])=>[e[0]*t+e[2]*n+e[4],e[1]*t+e[3]*n+e[5]],Le=(e,t)=>[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]],re="adm-image-viewer",Ue=e=>{const{dragLockRef:t,maxZoom:n}=e,r=m.useRef([]),i=m.useRef(null),o=m.useRef(null),[{matrix:c},h]=Re(()=>({matrix:Y(),config:{tension:200}})),s=ae(i),u=ae(o),d=m.useRef(!1),v=a=>{if(!s||!u)return{x:{position:0,minX:0,maxX:0},y:{position:0,minY:0,maxY:0}};const E=-s.width/2,O=-s.height/2,p=-u.width/2,y=-u.height/2,_=Z(a),S=_*u.width,T=_*u.height,j=E-(S-s.width),b=E,P=O-(T-s.height),L=O,[N,$]=$t(a,[p,y]);return{x:{position:N,minX:j,maxX:b},y:{position:$,minY:P,maxY:L}}},w=(a,E,O,p=0)=>[a<=E-p,a>=O+p],M=(a,E,O=!1)=>{if(!s||!u)return a;const p=Z(a),y=p*u.width,_=p*u.height,{x:{position:S,minX:T,maxX:j},y:{position:b,minY:P,maxY:L}}=v(a);if(E==="translate"){let N=S,$=b;return y>s.width?N=O?A(S,T,j):ye(S,T,j,p*50):N=-y/2,_>s.height?$=O?A(b,P,L):ye(b,P,L,p*50):$=-_/2,G(a,N-S,$-b)}if(E==="scale"&&O){const[N,$]=[y>s.width?A(S,T,j):-y/2,_>s.height?A(b,P,L):-_/2];return G(a,N-S,$-b)}return a};return Ft({onDrag:a=>{var E;if(a.first){const{x:{position:p,minX:y,maxX:_}}=v(c.get());r.current=w(p,y,_);return}if(a.pinching)return a.cancel();if(a.tap&&a.elapsedTime>0&&a.elapsedTime<1e3){(E=e.onTap)===null||E===void 0||E.call(e);return}const O=Z(c.get());if(t&&(t.current=O!==1),!d.current&&O<=1)h.start({matrix:Y()});else{const p=c.get(),y=[a.offset[0]-_e(p),a.offset[1]-xe(p)],_=G(p,...a.last?[y[0]+a.velocity[0]*a.direction[0]*200,y[1]+a.velocity[1]*a.direction[1]*200]:y);h.start({matrix:M(_,"translate",a.last),immediate:!a.last});const{x:{position:S,minX:T,maxX:j}}=v(_);a.last&&r.current.some(b=>b)&&w(S,T,j).some(b=>b)&&(t&&(t.current=!1),h.start({matrix:Y()}))}},onPinch:a=>{var E;d.current=!a.last;const[O]=a.offset;if(O<0)return;let p;n==="auto"?p=s&&u?Math.max(s.height/u.height,s.width/u.width):1:p=n;const y=a.last?A(O,1,p):O;if((E=e.onZoomChange)===null||E===void 0||E.call(e,y),a.last&&y<=1)h.start({matrix:Y()}),t&&(t.current=!1);else{if(!s)return;const _=c.get(),S=Z(_),T=a.origin[0]-s.width/2,j=a.origin[1]-s.height/2;let b=G(_,-T,-j);b=Nt(b,y/S),b=G(b,T,j),h.start({matrix:M(b,"scale",a.last),immediate:!a.last}),t&&(t.current=!0)}}},{target:i,drag:{from:()=>[_e(c.get()),xe(c.get())],pointer:{touch:!0}},pinch:{from:()=>[Z(c.get()),0],pointer:{touch:!0}}}),l.createElement("div",{className:`${re}-slide`},l.createElement("div",{className:`${re}-control`,ref:i},l.createElement(oe.div,{className:`${re}-image-wrapper`,style:{matrix:c}},l.createElement("img",{ref:o,src:e.image,draggable:!1,alt:e.image}))))},ie="adm-image-viewer",At=m.forwardRef((e,t)=>{const n=window.innerWidth+nt(16),[{x:r},i]=Re(()=>({x:e.defaultIndex*n,config:{tension:250,clamp:!0}})),o=e.images.length;function c(u,d=!1){var v;const w=A(u,0,o-1);(v=e.onIndexChange)===null||v===void 0||v.call(e,w),i.start({x:w*n,immediate:d})}m.useImperativeHandle(t,()=>({swipeTo:c}));const h=m.useRef(!1),s=Ze(u=>{if(h.current)return;const[d]=u.offset;if(u.last){const v=Math.floor(d/n),w=v+1,M=Math.min(u.velocity[0]*2e3,n)*u.direction[0];c(A(Math.round((d+M)/n),v,w))}else i.start({x:d,immediate:!0})},{transform:([u,d])=>[-u,d],from:()=>[r.get(),0],bounds:()=>({left:0,right:(o-1)*n}),rubberband:!0,axis:"x",pointer:{touch:!0}});return l.createElement("div",Object.assign({className:`${ie}-slides`},s()),l.createElement(oe.div,{className:`${ie}-indicator`},r.to(u=>`${A(Math.round(u/n),0,o-1)+1} / ${o}`)),l.createElement(oe.div,{className:`${ie}-slides-inner`,style:{x:r.to(u=>-u)}},e.images.map((u,d)=>l.createElement(Ue,{key:d,image:u,onTap:e.onTap,maxZoom:e.maxZoom,onZoomChange:v=>{if(v!==1){const w=Math.round(r.get()/n);i.start({x:w*n})}},dragLockRef:h}))))}),J="adm-image-viewer",ke={maxZoom:3,getContainer:null,visible:!1},We=e=>{var t,n,r;const i=ce(ke,e),o=l.createElement(Ce,{visible:i.visible,disableBodyScroll:!1,opacity:"thick",afterClose:i.afterClose,destroyOnClose:!0,className:(t=i==null?void 0:i.classNames)===null||t===void 0?void 0:t.mask},l.createElement("div",{className:le(`${J}-content`,(n=i==null?void 0:i.classNames)===null||n===void 0?void 0:n.body)},i.image&&l.createElement(Ue,{image:i.image,onTap:i.onClose,maxZoom:i.maxZoom})),i.image&&l.createElement("div",{className:`${J}-footer`},(r=i.renderFooter)===null||r===void 0?void 0:r.call(i,i.image),l.createElement(Se,{position:"bottom"})));return Ie(i.getContainer,o)},zt=Object.assign(Object.assign({},ke),{defaultIndex:0}),De=m.forwardRef((e,t)=>{var n,r,i;const o=ce(zt,e),[c,h]=m.useState(o.defaultIndex),s=m.useRef(null);m.useImperativeHandle(t,()=>({swipeTo:(v,w)=>{var M;h(v),(M=s.current)===null||M===void 0||M.swipeTo(v,w)}}));const u=m.useCallback(v=>{var w;v!==c&&(h(v),(w=o.onIndexChange)===null||w===void 0||w.call(o,v))},[o.onIndexChange,c]),d=l.createElement(Ce,{visible:o.visible,disableBodyScroll:!1,opacity:"thick",afterClose:o.afterClose,destroyOnClose:!0,className:(n=o==null?void 0:o.classNames)===null||n===void 0?void 0:n.mask},l.createElement("div",{className:le(`${J}-content`,(r=o==null?void 0:o.classNames)===null||r===void 0?void 0:r.body)},o.images&&l.createElement(At,{ref:s,defaultIndex:c,onIndexChange:u,images:o.images,onTap:o.onClose,maxZoom:o.maxZoom})),o.images&&l.createElement("div",{className:`${J}-footer`},(i=o.renderFooter)===null||i===void 0?void 0:i.call(o,o.images[c],c),l.createElement(Se,{position:"bottom"})));return Ie(o.getContainer,d)}),B=new Set;function Pt(e){ue();const t=Te(l.createElement(We,Object.assign({},e,{afterClose:()=>{var n;B.delete(t),(n=e.afterClose)===null||n===void 0||n.call(e)}})));return B.add(t),t}function Lt(e){ue();const t=Te(l.createElement(De,Object.assign({},e,{afterClose:()=>{var n;B.delete(t),(n=e.afterClose)===null||n===void 0||n.call(e)}})));return B.add(t),t}function ue(){B.forEach(e=>{e.close()}),B.clear()}const Ut=Me(De,{show:Lt}),kt=Me(We,{Multi:Ut,show:Pt,clear:ue}),k="adm-image-uploader",Ee=e=>{const{locale:t}=je(),{url:n,file:r,deletable:i,deleteIcon:o,onDelete:c,imageFit:h}=e,s=m.useMemo(()=>n||(r?URL.createObjectURL(r):""),[n,r]);m.useEffect(()=>()=>{r&&URL.revokeObjectURL(s)},[s,r]);function u(){return e.status==="pending"&&l.createElement("div",{className:`${k}-cell-mask`},l.createElement("span",{className:`${k}-cell-loading`},l.createElement(Ge,{color:"white"}),l.createElement("span",{className:`${k}-cell-mask-message`},t.ImageUploader.uploading)))}function d(){return i&&l.createElement("span",{className:`${k}-cell-delete`,onClick:c},o)}return l.createElement("div",{className:le(`${k}-cell`,e.status==="fail"&&`${k}-cell-fail`)},l.createElement(rt,{className:`${k}-cell-image`,src:s,fit:h,onClick:e.onClick}),u(),d())},F="adm-image-uploader",Wt={disableUpload:!1,deletable:!0,deleteIcon:l.createElement(qe,{className:`${F}-cell-delete-icon`}),showUpload:!0,multiple:!1,maxCount:0,defaultValue:[],accept:"image/*",preview:!0,showFailed:!0,imageFit:"cover"},Dt=m.forwardRef((e,t)=>{const{locale:n}=je(),r=ce(Wt,e),{columns:i}=r,[o,c]=it(r),[h,s]=m.useState([]),u=m.useRef(null),d=ae(u),v=m.useRef(null),[w,M]=m.useState(80),a=m.useRef(null);ne(()=>{const f=v.current;if(i&&d&&f){const g=d.width,I=jt(window.getComputedStyle(f).getPropertyValue("height"));M((g-I*(i-1))/i)}},[d==null?void 0:d.width]);const E={"--cell-size":w+"px"};ne(()=>{s(f=>f.filter(g=>g.url===void 0?!0:!o.some(I=>I.url===g.url)))},[o]),ne(()=>{var f;(f=r.onUploadQueueChange)===null||f===void 0||f.call(r,h.map(g=>({id:g.id,status:g.status})))},[h]);const O=m.useRef(0),{maxCount:p,onPreview:y,renderItem:_}=r;function S(f,g){return q(this,void 0,void 0,function*(){const{beforeUpload:I}=r;let R=f;return R=yield I==null?void 0:I(f,g),R})}function T(f){return r.showFailed?f:f.filter(g=>g.status!=="fail")}function j(f){var g;return q(this,void 0,void 0,function*(){f.persist();const{files:I}=f.target;if(!I)return;let R=[].slice.call(I);if(f.target.value="",r.beforeUpload){const x=R.map(D=>S(D,R));yield Promise.all(x).then(D=>{R=D.filter(Boolean)})}if(R.length===0)return;if(p>0){const x=o.length+R.length-p;x>0&&(R=R.slice(0,R.length-x),(g=r.onCountExceed)===null||g===void 0||g.call(r,x))}const X=R.map(x=>({id:O.current++,status:"pending",file:x}));s(x=>[...T(x),...X]);const W=[];yield Promise.all(X.map((x,D)=>q(this,void 0,void 0,function*(){try{const H=yield r.upload(x.file);W[D]=H,s(te=>te.map(U=>U.id===x.id?Object.assign(Object.assign({},U),{status:"success",url:H.url}):U))}catch(H){throw s(te=>te.map(U=>U.id===x.id?Object.assign(Object.assign({},U),{status:"fail"}):U)),H}}))).catch(x=>console.error(x)),c(x=>x.concat(W))})}const b=m.useRef(null);function P(f){b.current=kt.Multi.show({images:o.map(g=>g.url),defaultIndex:f,onClose:()=>{b.current=null}})}Fe(()=>{var f;(f=b.current)===null||f===void 0||f.close()});const L=T(h),N=r.showUpload&&(p===0||o.length+L.length<p),$=()=>o.map((f,g)=>{var I,R;const X=l.createElement(Ee,{key:(I=f.key)!==null&&I!==void 0?I:g,url:(R=f.thumbnailUrl)!==null&&R!==void 0?R:f.url,deletable:r.deletable,deleteIcon:r.deleteIcon,imageFit:r.imageFit,onClick:()=>{r.preview&&P(g),y&&y(g,f)},onDelete:()=>q(void 0,void 0,void 0,function*(){var W;(yield(W=r.onDelete)===null||W===void 0?void 0:W.call(r,f))!==!1&&c(o.filter((D,H)=>H!==g))})});return _?_(X,f,o):X}),de=l.createElement(l.Fragment,null,$(),h.map(f=>!r.showFailed&&f.status==="fail"?null:l.createElement(Ee,{key:f.id,file:f.file,deletable:f.status!=="pending",deleteIcon:r.deleteIcon,status:f.status,imageFit:r.imageFit,onDelete:()=>{s(h.filter(g=>g.id!==f.id))}})),l.createElement("div",{className:`${F}-upload-button-wrap`,style:N?void 0:{display:"none"}},r.children||l.createElement("span",{className:`${F}-cell ${F}-upload-button`,role:"button","aria-label":n.ImageUploader.upload},l.createElement("span",{className:`${F}-upload-button-icon`},l.createElement(ot,null))),!r.disableUpload&&l.createElement("input",{ref:a,capture:r.capture,accept:r.accept,multiple:r.multiple,type:"file",className:`${F}-input`,onChange:j,"aria-hidden":!0})));return m.useImperativeHandle(t,()=>({get nativeElement(){return a.current}})),Ye(r,l.createElement("div",{className:F,ref:u},i?l.createElement(st,{className:`${F}-grid`,columns:i,style:E},l.createElement("div",{className:`${F}-gap-measure`,ref:v}),de.props.children):l.createElement(at,{className:`${F}-space`,wrap:!0,block:!0},de.props.children)))}),Ht=async e=>{const t=new TextEncoder().encode(e),n=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(n)).map(o=>o.toString(16).padStart(2,"0")).join("")},Qt=()=>{const e=Qe(),t=lt(),n=ge(()=>t?t.db.web.orderBy("order").last().then(d=>((d==null?void 0:d.order)||0)+1):0,[t],0),r=ge(async()=>t?await t.db.web.orderBy("url").keys():[],[t],[]),[i]=z.useForm(),[o,c]=m.useState(),[h,s]=m.useState(!1);m.useEffect(()=>{n&&c({order:n})},[n]);const u=async d=>{t&&(s(!0),await t.db.web.add({...d,hostname:new URL(d.url).hostname,order:+d.order}).then(()=>{fe.show({icon:"success",content:"新建成功!"}),i.resetFields(),e(-1)}).catch(v=>{fe.show({icon:"fail",content:v.message})}),s(!1))};return C.jsx("div",{children:o&&C.jsxs(z,{name:"form",form:i,onFinish:u,initialValues:{order:n},footer:C.jsx(me,{block:!0,type:"submit",color:"primary",loading:h,children:"提交"}),children:[C.jsx(z.Item,{name:"title",label:"名称",rules:[{required:!0}],children:C.jsx(ve,{placeholder:"请输入名称"})}),C.jsx(z.Item,{name:"desc",label:"描述",children:C.jsx(pe,{placeholder:"请输入描述",autoSize:!0})}),C.jsx(z.Item,{name:"url",label:"地址",validateFirst:!0,rules:[{required:!0},{validator:(d,v)=>{try{new URL(v)}catch{return Promise.reject(new Error("url格式错误!"))}return r.includes(v)?Promise.reject(new Error("url不能重复!")):Promise.resolve()}}],children:C.jsx(pe,{placeholder:"请输入地址",autoSize:!0})}),C.jsx(z.Item,{name:"icon",label:"icon",children:C.jsx(Dt,{multiple:!0,maxCount:1,upload:async d=>{const v=URL.createObjectURL(d),w=await Ke(v),M=await Ht(w),a=await Je(M,w);return a.success?{url:a.data}:Promise.reject()}})}),C.jsx(z.Item,{name:"tag",label:"标签",children:C.jsx(ct,{})}),C.jsx(z.Item,{name:"order",label:"排序",rules:[{required:!0}],children:C.jsx(ve,{type:"number",placeholder:"请输入排序"})}),C.jsx(me,{className:"ml-4 mb-2",size:"small",color:"primary",onClick:()=>{t&&e(`/${t.path}/tag`)},children:"新增"})]})})};export{Qt as default};
