import{r as p,j as e,B as x,A as l}from"./index-ossK1LZ4.js";import{u as y,S as w}from"./dexie-react-hooks-SU3VEuhl.js";import{C as g}from"./floating-bubble-DKfBl2R8.js";import{F as n,I as d}from"./input-CrX-0v2G.js";import{F}from"./FilterTag-C75_zTfn.js";import{F as C,W as I}from"./WebCardList-9_tZsVDt.js";const L=[{key:"author",label:"作者"}],S=()=>{const u=p.useRef(null),[i,m]=p.useState(),h=y(async()=>{var f;let a=[],c=!1;if(i){if((f=i.tags)!=null&&f.length){const r=[...i.tags];a=await l.db.web.where("tags").equals(r.shift()).and(t=>!!(t.tags&&r.every(s=>{var o;return(o=t.tags)==null?void 0:o.includes(s)}))).toArray(),c=!0}c||(a=await l.db.web.toArray()),["title","url","author"].forEach(r=>{i[r]&&(a=a.filter(t=>{var s;return(s=t[r])==null?void 0:s.includes(i[r])}))}),i.desc&&(a=a.filter(r=>[r.desc,r.simpleDesc].some(t=>t==null?void 0:t.includes(i.desc))))}else a=await l.db.web.toArray();a.sort((r,t)=>r.order-t.order);const j=await l.db.tagGroup.orderBy("order").toArray();return await Promise.all(a.map(async r=>{const t=r.tags&&(await Promise.all(r.tags.map(async s=>await l.db.tag.get(s)))).reduce((s,o)=>(s[o.group]||(s[o.group]=[]),s[o.group].push(o),s),{});return{...r,tags:j.filter(s=>t==null?void 0:t[s.id]).map(s=>({...s,list:t[s.id]}))}}))},[i]),b=()=>{var a,c;(a=u.current)==null||a.resetFields(),m((c=u.current)==null?void 0:c.getFieldsValue())};return e.jsxs("div",{className:"px-4",children:[e.jsx(g,{children:e.jsx(g.Panel,{title:"筛选",children:e.jsxs(n,{ref:u,name:"form",onFinish:m,footer:e.jsxs(w,{children:[e.jsx(x,{block:!0,type:"submit",color:"primary",children:"搜索"}),e.jsx(x,{block:!0,onClick:b,children:"重置"})]}),children:[e.jsx(n.Item,{name:"title",label:"名称",children:e.jsx(d,{})}),e.jsx(n.Item,{name:"url",label:"地址",children:e.jsx(d,{})}),e.jsx(n.Item,{name:"author",label:"作者",children:e.jsx(d,{})}),e.jsx(n.Item,{name:"desc",label:"详情",children:e.jsx(d,{})}),e.jsx(n.Item,{name:"tags",children:e.jsx(F,{webConfig:l})})]})},"1")}),e.jsx(C,{path:l.path}),e.jsx(I,{webConfig:l,list:h,extraDescList:L})]})};export{S as default};
