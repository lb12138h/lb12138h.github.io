import{r as p,j as s,B as b,y as l}from"./index-DERllzhn.js";import{u as w}from"./dexie-react-hooks-Dwhc-AuF.js";import{C as x}from"./index-BwC_fqYy.js";import{F as n,I as m}from"./input-Clf9kwip.js";import{S as F}from"./space-bauQVJ63.js";import{F as k}from"./FilterTag-OCnJNN3E.js";import{F as I}from"./FloatingBubbleAdd-DGheAM8a.js";import{W as C}from"./WebCardList-B6nlr2iM.js";import"./index-hSoGQ23Z.js";import"./selector-DpT9G-B8.js";import"./floating-bubble-C89P-5Oq.js";import"./index-Bj1fzAf0.js";const g=[{key:"author",label:"作者"},{key:"sinicize",label:"汉化组"},{key:"press",label:"出版社"},{key:"series",label:"系列"}],L=[{key:"orginTitle",label:"源名称"},{key:"inWebTitle",label:"网站中名称"},...g],G=()=>{const d=p.useRef(null),[a,u]=p.useState(),h=w(async()=>{var f;let t=[],c=!1;if(a){if((f=a.tags)!=null&&f.length){const e=[...a.tags];t=await l.db.web.where("tags").equals(e.shift()).and(r=>!!(r.tags&&e.every(i=>{var o;return(o=r.tags)==null?void 0:o.includes(i)}))).toArray(),c=!0}c||(t=await l.db.web.toArray()),a.title&&(t=t.filter(e=>[e.title,e.orginTitle,e.inWebTitle].some(r=>r==null?void 0:r.includes(a.title)))),["url","author","sinicize","press","series"].forEach(e=>{a[e]&&(t=t.filter(r=>{var i;return(i=r[e])==null?void 0:i.includes(a[e])}))}),a.desc&&(t=t.filter(e=>[e.desc,e.simpleDesc].some(r=>r==null?void 0:r.includes(a.desc))))}else t=await l.db.web.toArray();t.sort((e,r)=>e.order-r.order);const j=await l.db.tagGroup.orderBy("order").toArray();return await Promise.all(t.map(async e=>{const r=e.tags&&(await Promise.all(e.tags.map(async i=>await l.db.tag.get(i)))).reduce((i,o)=>(i[o.group]||(i[o.group]=[]),i[o.group].push(o),i),{});return{...e,tags:j.filter(i=>r==null?void 0:r[i.id]).map(i=>({...i,list:r[i.id]}))}}))},[a]),y=()=>{var t,c;(t=d.current)==null||t.resetFields(),u((c=d.current)==null?void 0:c.getFieldsValue())};return s.jsxs("div",{className:"px-4",children:[s.jsx(x,{children:s.jsx(x.Panel,{title:"筛选",children:s.jsxs(n,{ref:d,name:"form",onFinish:u,footer:s.jsxs(F,{children:[s.jsx(b,{block:!0,type:"submit",color:"primary",children:"搜索"}),s.jsx(b,{block:!0,onClick:y,children:"重置"})]}),children:[s.jsx(n.Item,{name:"title",label:"名称",children:s.jsx(m,{})}),s.jsx(n.Item,{name:"url",label:"地址",children:s.jsx(m,{})}),s.jsx(n.Item,{name:"desc",label:"详情",children:s.jsx(m,{})}),g.map(t=>s.jsx(n.Item,{name:t.key,label:t.label,children:s.jsx(m,{})},t.key)),s.jsx(n.Item,{name:"tags",children:s.jsx(k,{webConfig:l})})]})},"1")}),s.jsx(I,{path:l.path}),s.jsx(C,{webConfig:l,list:h,extraDescList:L})]})};export{G as default};
