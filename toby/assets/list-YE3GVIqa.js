import{r as b,j as r,B as p,h as l}from"./index-D4y1DPfe.js";import{u as w,S as F}from"./dexie-react-hooks-BslBxNB1.js";import{C as x}from"./floating-bubble-ChjOW_dq.js";import{F as n,I as d}from"./input-BGi632mO.js";import{F as k}from"./FilterTag-DFHZpZ6h.js";import{F as I,W as C}from"./WebCardList-CdA-IekA.js";const g=[{key:"author",label:"作者"},{key:"sinicize",label:"汉化组"},{key:"press",label:"出版社"},{key:"series",label:"系列"}],L=[{key:"orginTitle",label:"源名称"},{key:"inWebTitle",label:"网站中名称"},...g],E=()=>{const u=b.useRef(null),[i,m]=b.useState(),h=w(async()=>{var f;let t=[],c=!1;if(i){if((f=i.tags)!=null&&f.length){const e=[...i.tags];t=await l.db.web.where("tags").equals(e.shift()).and(s=>!!(s.tags&&e.every(a=>{var o;return(o=s.tags)==null?void 0:o.includes(a)}))).toArray(),c=!0}c||(t=await l.db.web.toArray()),i.title&&(t=t.filter(e=>[e.title,e.orginTitle,e.inWebTitle].some(s=>s==null?void 0:s.includes(i.title)))),["url","author","sinicize","press","series"].forEach(e=>{i[e]&&(t=t.filter(s=>{var a;return(a=s[e])==null?void 0:a.includes(i[e])}))}),i.desc&&(t=t.filter(e=>[e.desc,e.simpleDesc].some(s=>s==null?void 0:s.includes(i.desc))))}else t=await l.db.web.toArray();t.sort((e,s)=>e.order-s.order);const y=await l.db.tagGroup.orderBy("order").toArray();return await Promise.all(t.map(async e=>{const s=e.tags&&(await Promise.all(e.tags.map(async a=>await l.db.tag.get(a)))).reduce((a,o)=>(a[o.group]||(a[o.group]=[]),a[o.group].push(o),a),{});return{...e,tags:y.filter(a=>s==null?void 0:s[a.id]).map(a=>({...a,list:s[a.id]}))}}))},[i]),j=()=>{var t,c;(t=u.current)==null||t.resetFields(),m((c=u.current)==null?void 0:c.getFieldsValue())};return r.jsxs("div",{className:"px-4",children:[r.jsx(x,{children:r.jsx(x.Panel,{title:"筛选",children:r.jsxs(n,{ref:u,name:"form",onFinish:m,footer:r.jsxs(F,{children:[r.jsx(p,{block:!0,type:"submit",color:"primary",children:"搜索"}),r.jsx(p,{block:!0,onClick:j,children:"重置"})]}),children:[r.jsx(n.Item,{name:"title",label:"名称",children:r.jsx(d,{})}),r.jsx(n.Item,{name:"url",label:"地址",children:r.jsx(d,{})}),r.jsx(n.Item,{name:"desc",label:"详情",children:r.jsx(d,{})}),g.map(t=>r.jsx(n.Item,{name:t.key,label:t.label,children:r.jsx(d,{})},t.key)),r.jsx(n.Item,{name:"tags",children:r.jsx(k,{webConfig:l})})]})},"1")}),r.jsx(I,{path:l.path}),r.jsx(C,{webConfig:l,list:h,extraDescList:L})]})};export{E as default};
