import{r as b,j as e,B as p,h as l}from"./index-Cysz9zD0.js";import{u as w,S as F}from"./dexie-react-hooks-1XYa5HEM.js";import{C as x}from"./floating-bubble-CcTX1PQ-.js";import{F as o,I as u}from"./input-CEaxjduA.js";import{F as k}from"./FilterTag-DHm5gu_a.js";import{F as I,W as C}from"./WebCardList-CaYz73oc.js";const g=[{key:"author",label:"作者"},{key:"sinicize",label:"汉化组"},{key:"press",label:"出版社"},{key:"series",label:"系列"}],L=[{key:"orginTitle",label:"源名称"},{key:"inWebTitle",label:"网站中名称"},...g],E=()=>{const d=b.useRef(null),[i,m]=b.useState(),h=w(async()=>{var f;let s=[],c=!1;if(i){if((f=i.tags)!=null&&f.length){const r=[...i.tags];s=await l.db.web.where("tags").equals(r.shift()).and(t=>!!(t.tags&&r.every(a=>{var n;return(n=t.tags)==null?void 0:n.includes(a)}))).toArray(),c=!0}c||(s=await l.db.web.toArray()),i.title&&(s=s.filter(r=>[r.title,r.orginTitle,r.inWebTitle].some(t=>t==null?void 0:t.includes(i.title)))),["url","author","sinicize","press","series"].forEach(r=>{i[r]&&(s=s.filter(t=>{var a;return(a=t[r])==null?void 0:a.includes(i[r])}))}),i.desc&&(s=s.filter(r=>[r.desc,r.simpleDesc].some(t=>t==null?void 0:t.includes(i.desc))))}else s=await l.db.web.toArray();const y=await l.db.tagGroup.orderBy("order").toArray();return await Promise.all(s.map(async r=>{const t=r.tags&&(await Promise.all(r.tags.map(async a=>await l.db.tag.get(a)))).reduce((a,n)=>(a[n.group]||(a[n.group]=[]),a[n.group].push(n),a),{});return{...r,tags:y.filter(a=>t==null?void 0:t[a.id]).map(a=>({...a,list:t[a.id]}))}}))},[i]),j=()=>{var s,c;(s=d.current)==null||s.resetFields(),m((c=d.current)==null?void 0:c.getFieldsValue())};return e.jsxs("div",{className:"px-4",children:[e.jsx(x,{children:e.jsx(x.Panel,{title:"筛选",children:e.jsxs(o,{ref:d,name:"form",onFinish:m,footer:e.jsxs(F,{children:[e.jsx(p,{block:!0,type:"submit",color:"primary",children:"搜索"}),e.jsx(p,{block:!0,onClick:j,children:"重置"})]}),children:[e.jsx(o.Item,{name:"title",label:"名称",children:e.jsx(u,{})}),e.jsx(o.Item,{name:"url",label:"地址",children:e.jsx(u,{})}),e.jsx(o.Item,{name:"desc",label:"详情",children:e.jsx(u,{})}),g.map(s=>e.jsx(o.Item,{name:s.key,label:s.label,children:e.jsx(u,{})},s.key)),e.jsx(o.Item,{name:"tags",children:e.jsx(k,{webConfig:l})})]})},"1")}),e.jsx(I,{path:l.path}),e.jsx(C,{webConfig:l,list:h,extraDescList:L})]})};export{E as default};
