import{r as p,j as e,B as x,n as i}from"./index-DKKuqkso.js";import{u as w,S as y}from"./dexie-react-hooks-pxC-h1Kn.js";import{C as g}from"./floating-bubble-Cea9ZNJ0.js";import{F as o,I as c}from"./input-4uKEuujg.js";import{F,W as C}from"./WebCardList-CDTIanEv.js";import{F as I}from"./FilterTag-DYh5E1up.js";const W=()=>{const u=p.useRef(null),[n,d]=p.useState(),b=w(async()=>{var f;let t=[],m=!1;if(n){if((f=n.tags)!=null&&f.length){const r=[...n.tags];t=await i.db.web.where("tags").equals(r.shift()).and(a=>!!(a.tags&&r.every(s=>{var l;return(l=a.tags)==null?void 0:l.includes(s)}))).toArray(),m=!0}m||(t=await i.db.web.toArray()),["title","url"].forEach(r=>{n[r]&&(t=t.filter(a=>{var s;return(s=a[r])==null?void 0:s.includes(n[r])}))})}else t=await i.db.web.toArray();const j=await i.db.tagGroup.orderBy("order").toArray();return await Promise.all(t.map(async r=>{const a=r.tags&&(await Promise.all(r.tags.map(async s=>await i.db.tag.get(s)))).reduce((s,l)=>(s[l.group]||(s[l.group]=[]),s[l.group].push(l),s),{});return{...r,tags:j.filter(s=>a==null?void 0:a[s.id]).map(s=>({...s,list:a[s.id]}))}}))},[]),h=()=>{var t,m;(t=u.current)==null||t.resetFields(),d((m=u.current)==null?void 0:m.getFieldsValue())};return e.jsxs("div",{className:"px-4",children:[e.jsx(g,{children:e.jsx(g.Panel,{title:"筛选",children:e.jsxs(o,{ref:u,name:"form",onFinish:d,footer:e.jsxs(y,{children:[e.jsx(x,{block:!0,type:"submit",color:"primary",children:"搜索"}),e.jsx(x,{block:!0,onClick:h,children:"重置"})]}),children:[e.jsx(o.Item,{name:"title",label:"名称",children:e.jsx(c,{})}),e.jsx(o.Item,{name:"url",label:"地址",children:e.jsx(c,{})}),e.jsx(o.Item,{name:"author",label:"作者",children:e.jsx(c,{})}),e.jsx(o.Item,{name:"desc",label:"详情",children:e.jsx(c,{})}),e.jsx(o.Item,{name:"tags",children:e.jsx(I,{webConfig:i})})]})},"1")}),e.jsx(F,{path:i.path}),e.jsx(C,{webConfig:i,list:b})]})};export{W as default};
