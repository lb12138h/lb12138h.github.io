import{c as L,a as ne,b as ae,r as j,_ as se,d as ie,e as oe,f as H,h as J,i as ce,R as T,k as I,l as N,w as G,S as le,m as fe,j as u,B,s as x}from"./index-ossK1LZ4.js";import{u as D,S as ue}from"./dexie-react-hooks-SU3VEuhl.js";import{u as de,b as me,t as be,a as ge,F as $,I as _}from"./input-CrX-0v2G.js";import{u as ve,C as w}from"./floating-bubble-DKfBl2R8.js";import{F as pe}from"./FilterTag-C75_zTfn.js";import{F as ye,W as K}from"./WebCardList-9_tZsVDt.js";function he(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var M=he,Te=typeof L=="object"&&L&&L.Object===Object&&L,je=Te,xe=je,Se=typeof self=="object"&&self&&self.Object===Object&&self,ke=xe||Se||Function("return this")(),Y=ke,Ee=Y,$e=function(){return Ee.Date.now()},we=$e,Oe=/\s/;function Le(e){for(var t=e.length;t--&&Oe.test(e.charAt(t)););return t}var Re=Le,Ce=Re,_e=/^\s+/;function Fe(e){return e&&e.slice(0,Ce(e)+1).replace(_e,"")}var We=Fe,Ie=Y,Ne=Ie.Symbol,Z=Ne,U=Z,ee=Object.prototype,Me=ee.hasOwnProperty,Pe=ee.toString,O=U?U.toStringTag:void 0;function Ae(e){var t=Me.call(e,O),n=e[O];try{e[O]=void 0;var s=!0}catch{}var o=Pe.call(e);return s&&(t?e[O]=n:delete e[O]),o}var Ge=Ae,Be=Object.prototype,De=Be.toString;function Ke(e){return De.call(e)}var Ue=Ke,z=Z,ze=Ge,Ve=Ue,Qe="[object Null]",Xe="[object Undefined]",V=z?z.toStringTag:void 0;function qe(e){return e==null?e===void 0?Xe:Qe:V&&V in Object(e)?ze(e):Ve(e)}var He=qe;function Je(e){return e!=null&&typeof e=="object"}var Ye=Je,Ze=He,et=Ye,tt="[object Symbol]";function rt(e){return typeof e=="symbol"||et(e)&&Ze(e)==tt}var nt=rt,at=We,Q=M,st=nt,X=NaN,it=/^[-+]0x[0-9a-f]+$/i,ot=/^0b[01]+$/i,ct=/^0o[0-7]+$/i,lt=parseInt;function ft(e){if(typeof e=="number")return e;if(st(e))return X;if(Q(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=Q(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=at(e);var n=ot.test(e);return n||ct.test(e)?lt(e.slice(2),n?2:8):it.test(e)?X:+e}var ut=ft,dt=M,F=we,q=ut,mt="Expected a function",bt=Math.max,gt=Math.min;function vt(e,t,n){var s,o,i,c,l,d,p=0,a=!1,r=!1,f=!0;if(typeof e!="function")throw new TypeError(mt);t=q(t)||0,dt(n)&&(a=!!n.leading,r="maxWait"in n,i=r?bt(q(n.maxWait)||0,t):i,f="trailing"in n?!!n.trailing:f);function y(v){var S=s,E=o;return s=o=void 0,p=v,c=e.apply(E,S),c}function m(v){return p=v,l=setTimeout(h,t),a?y(v):c}function b(v){var S=v-d,E=v-p,A=t-S;return r?gt(A,i-E):A}function g(v){var S=v-d,E=v-p;return d===void 0||S>=t||S<0||r&&E>=i}function h(){var v=F();if(g(v))return P(v);l=setTimeout(h,b(v))}function P(v){return l=void 0,f&&s?y(v):(s=o=void 0,c)}function te(){l!==void 0&&clearTimeout(l),p=0,s=d=o=l=void 0}function re(){return l===void 0?c:P(F())}function C(){var v=F(),S=g(v);if(s=arguments,o=this,d=v,S){if(l===void 0)return m(d);if(r)return clearTimeout(l),l=setTimeout(h,t),y(d)}return l===void 0&&(l=setTimeout(h,t)),c}return C.cancel=te,C.flush=re,C}var pt=vt,yt=pt,ht=M,Tt="Expected a function";function jt(e,t,n){var s=!0,o=!0;if(typeof e!="function")throw new TypeError(Tt);return ht(n)&&(s="leading"in n?!!n.leading:s,o="trailing"in n?!!n.trailing:o),yt(e,t,{leading:s,maxWait:t,trailing:o})}var xt=jt;const St=ne(xt);function kt(e,t){var n,s=ae(e),o=(n=t==null?void 0:t.wait)!==null&&n!==void 0?n:1e3,i=j.useMemo(function(){return St(function(){for(var c=[],l=0;l<arguments.length;l++)c[l]=arguments[l];return s.current.apply(s,se([],ie(c),!1))},o,t)},[]);return oe(function(){i.cancel()}),{run:i,cancel:i.cancel,flush:i.flush}}function Et(e,t){const n=de(e);H(()=>{const s=t.current;if(s)if(window.ResizeObserver){let o;const i=new ResizeObserver(()=>{o=window.requestAnimationFrame(()=>n(s))});return i.observe(s),()=>{window.cancelAnimationFrame(o),i.disconnect()}}else n(s)},[t])}const $t=(e,t)=>{const[{scrollLeft:n},s]=J(()=>({scrollLeft:0,config:{tension:300,clamp:!0}}));function o(i=!1){const c=e.current;if(!c||t===void 0)return;const d=c.children.item(t).children.item(0),p=d.offsetLeft,a=d.offsetWidth,r=c.offsetWidth,f=c.scrollWidth,y=c.scrollLeft;if(f-r<=0)return;const b=me(p-(r-a)/2,0,f-r);s.start({scrollLeft:b,from:{scrollLeft:y},immediate:i&&!n.isAnimating})}return H(()=>{o(!0)},[]),ce(()=>{o()},[t]),ve(()=>{o(!0)},e,{subtree:!0,childList:!0,characterData:!0}),{scrollLeft:n,animate:o}},R="adm-scroll-mask",wt=e=>{const t=j.useRef(null),[{leftMaskOpacity:n,rightMaskOpacity:s},o]=J(()=>({leftMaskOpacity:0,rightMaskOpacity:0,config:{clamp:!0}})),{run:i}=kt((c=!1)=>{if(!t.current)return;const d=e.scrollTrackRef.current;if(!d)return;const p=d.scrollLeft,a=p>0,r=p+d.offsetWidth<d.scrollWidth;o.start({leftMaskOpacity:a?1:0,rightMaskOpacity:r?1:0,immediate:c})},{wait:100,trailing:!0,leading:!0});return j.useEffect(()=>{i(!0)},[]),j.useEffect(()=>{const c=e.scrollTrackRef.current;if(c)return c.addEventListener("scroll",i),()=>c.removeEventListener("scroll",i)},[]),T.createElement(T.Fragment,null,T.createElement(I.div,{ref:t,className:N(R,`${R}-left`),style:{opacity:n}}),T.createElement(I.div,{className:N(R,`${R}-right`),style:{opacity:s}}))},k="adm-capsule-tabs",Ot=()=>null,Lt=e=>{var t;const n=j.useRef(null),s=j.useRef(null),o={};let i=null;const c=[];be(e.children,(r,f)=>{if(!j.isValidElement(r))return;const y=r.key;if(typeof y!="string")return;f===0&&(i=y);const m=c.push(r);o[y]=m-1});const[l,d]=ge({value:e.activeKey,defaultValue:(t=e.defaultActiveKey)!==null&&t!==void 0?t:i,onChange:r=>{var f;r!==null&&((f=e.onChange)===null||f===void 0||f.call(e,r))}}),{scrollLeft:p,animate:a}=$t(n,o[l]);return Et(()=>{a(!0)},s),G(e,T.createElement("div",{className:k,ref:s},T.createElement("div",{className:`${k}-header`},T.createElement(wt,{scrollTrackRef:n}),T.createElement(I.div,{className:`${k}-tab-list`,ref:n,scrollLeft:p},c.map(r=>G(r.props,T.createElement("div",{key:r.key,className:`${k}-tab-wrapper`},T.createElement("div",{onClick:()=>{const{key:f}=r;r.props.disabled||f!=null&&d(f.toString())},className:N(`${k}-tab`,{[`${k}-tab-active`]:r.key===l,[`${k}-tab-disabled`]:r.props.disabled})},r.props.title)))))),c.map(r=>{if(r.props.children===void 0)return null;const f=r.key===l;return T.createElement(le,{key:r.key,active:f,forceRender:r.props.forceRender,destroyOnClose:r.props.destroyOnClose},T.createElement("div",{className:`${k}-content`,style:{display:f?"block":"none"}},r.props.children))})))},W=fe(Lt,{Tab:Ot}),Nt=()=>{const e=j.useRef(null),[t,n]=j.useState(),[s,o]=j.useState(),[i,c]=j.useState(""),l=D(()=>x.db.tag.filter(a=>!i||a.group===+i).sortBy("groupOrder"),[i]),d=D(async()=>{var y;let a=[],r=!1;if(t){if((y=t.tags)!=null&&y.length){const m=[...t.tags];a=await x.db.web.where("tags").equals(m.shift()).and(b=>!!(b.tags&&m.every(g=>{var h;return(h=b.tags)==null?void 0:h.includes(g)}))).toArray(),r=!0}r||(a=await x.db.web.toArray()),["title","url"].forEach(m=>{t[m]&&(a=a.filter(b=>{var g;return(g=b[m])==null?void 0:g.includes(t[m])}))}),t.desc&&(a=a.filter(m=>[m.desc,m.simpleDesc].some(b=>b==null?void 0:b.includes(t.desc))))}else a=await x.db.web.toArray();a.sort((m,b)=>m.order-b.order);const f=await x.db.tagGroup.orderBy("order").toArray();return o(f),await Promise.all(a.map(async m=>{const b=m.tags&&(await Promise.all(m.tags.map(async g=>await x.db.tag.get(g)))).reduce((g,h)=>(g[h.group]||(g[h.group]=[]),g[h.group].push(h),g),{});return{...m,tags:f.filter(g=>b==null?void 0:b[g.id]).map(g=>({...g,list:b[g.id]}))}}))},[t]),p=()=>{var a,r;(a=e.current)==null||a.resetFields(),n((r=e.current)==null?void 0:r.getFieldsValue())};return u.jsxs("div",{className:"px-4",children:[u.jsxs(w,{children:[u.jsx(w.Panel,{title:"筛选",children:u.jsxs($,{ref:e,name:"form",onFinish:n,footer:u.jsxs(ue,{children:[u.jsx(B,{block:!0,type:"submit",color:"primary",children:"搜索"}),u.jsx(B,{block:!0,onClick:p,children:"重置"})]}),children:[u.jsx($.Item,{name:"title",label:"名称",children:u.jsx(_,{})}),u.jsx($.Item,{name:"url",label:"地址",children:u.jsx(_,{})}),u.jsx($.Item,{name:"desc",label:"详情",children:u.jsx(_,{})}),u.jsx($.Item,{name:"tags",children:u.jsx(pe,{webConfig:x})})]})},"1"),u.jsx(w.Panel,{title:"根据Tag组显示",children:u.jsxs(W,{activeKey:i,onChange:a=>c(a),children:[u.jsx(W.Tab,{title:"无"},""),s==null?void 0:s.map(a=>u.jsx(W.Tab,{title:a.title},a.id))]})},"2")]}),u.jsx(ye,{path:x.path}),i?u.jsx(w,{children:l==null?void 0:l.map(a=>u.jsx(w.Panel,{title:a.title,children:u.jsx(K,{webConfig:x,list:d==null?void 0:d.filter(r=>r.tags.some(f=>f.id===+i&&f.list.some(y=>y.id===a.id)))})},a.id+""))}):u.jsx(K,{webConfig:x,list:d})]})};export{Nt as default};
