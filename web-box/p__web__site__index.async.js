"use strict";(self.webpackChunkapps_ant_admin=self.webpackChunkapps_ant_admin||[]).push([[462],{24936:function(ge,W,e){var N=e(73193),x=e.n(N),z=e(97190),v=e(44194),k=e(31549),D=function(A){var Y=A.modalVisible,J=A.children;return(0,k.jsx)(z.Z,x()(x()({destroyOnClose:!0,title:"\u65B0\u5EFA",width:"80vw",open:Y,footer:null},A),{},{children:J}))};W.Z=D},61158:function(ge,W,e){e.r(W),e.d(W,{default:function(){return Xe}});var N=e(45332),x=e.n(N),z=e(90819),v=e.n(z),k=e(89933),D=e.n(k),ee=e(24936),A=e(4977),Y=e.n(A),J=e(78796),pe=e.n(J),me=e(41553),be=e.n(me),ye=e(49488),Ce=e.n(ye),Se=e(84047),Te=e.n(Se),je=e(10154),xe=e.n(je),Ie=e(99338),Pe=function(y){Ce()(a,y);var u=Te()(a);function a(){var r;return pe()(this,a),r=u.call(this,"HashDB"),xe()(be()(r),"hash",void 0),r.version(1).stores({hash:"&hash"}),r}return Y()(a)}(Ie.ZP),M=new Pe,Ee=function(){var y=D()(v()().mark(function u(){return v()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:case"end":return r.stop()}},u)}));return function(){return y.apply(this,arguments)}}();M.on("populate",Ee),window.hashDb=M;var re=e(51264),De=function(){var y=D()(v()().mark(function u(a){var r,l,s,m,f=arguments;return v()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=f.length>1&&f[1]!==void 0?f[1]:"img",n.next=3,M.hash.get(a);case 3:if(l=n.sent,l!=null&&l.base64){n.next=14;break}return n.next=7,(0,re.I)({path:"hash/".concat(r,"/").concat(a),autoCreate:!1});case 7:if(s=n.sent,!s.success){n.next=13;break}return m=s.data.content,n.next=12,M.hash.put({hash:a,base64:m});case 12:return n.abrupt("return",{status:200,success:!0,data:m});case 13:return n.abrupt("return",s);case 14:return n.abrupt("return",{status:200,success:!0,data:l.base64});case 15:case"end":return n.stop()}},u)}));return function(a){return y.apply(this,arguments)}}(),Be=function(){var y=D()(v()().mark(function u(a){var r,l,s,m,f;return v()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=a.hash,l=a.content,s=a.type,m=s===void 0?"img":s,n.next=3,M.hash.get(r);case 3:if(f=n.sent,f!=null&&f.hash){n.next=10;break}return n.next=7,M.hash.put({hash:r,base64:l});case 7:return n.next=9,(0,re.I)({path:"hash/".concat(m,"/").concat(r),content:l,autoCreate:!0});case 9:return n.abrupt("return",n.sent);case 10:return n.abrupt("return",{status:200,success:!0,data:f.base64});case 11:case"end":return n.stop()}},u)}));return function(a){return y.apply(this,arguments)}}(),Re=e(94e3),Ze=e(87660),ae=e(8053),G=e(25248),te=e(16478),Fe=e(34934),p=e(44194),t=e(31549),Oe=function(u){return new Promise(function(a,r){var l=new FileReader;l.readAsDataURL(u),l.onload=function(){return a(l.result)},l.onerror=function(s){return r(s)}})},we=function(u){var a=["image/jpeg","image/png","image/svg+xml"].includes(u.type);a||G.ZP.error("You can only upload JPG/PNG/SVG file!");var r=u.size/1024/1024<2;return r||G.ZP.error("Image must smaller than 2MB!"),!1},Le=function(u){var a=u.value,r=u.onChange,l=u.onlyPreview,s=(0,p.useState)(!1),m=x()(s,2),f=m[0],S=m[1],n=(0,p.useState)(),w=x()(n,2),b=w[0],E=w[1],R=function(){var C=D()(v()().mark(function I(T){var g,Z;return v()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:if(!f){h.next=2;break}return h.abrupt("return");case 2:return S(!0),console.log("info",T),h.next=6,Oe(T.file.originFileObj||T.file);case 6:return g=h.sent,E(g),h.next=10,(0,ae.x5)(g);case 10:return Z=h.sent,h.next=13,Be({hash:Z,content:g});case 13:r==null||r(Z),S(!1);case 15:case"end":return h.stop()}},I)}));return function(T){return C.apply(this,arguments)}}(),B=(0,t.jsxs)("button",{style:{border:0,background:"none"},type:"button",children:[f?(0,t.jsx)(Re.Z,{}):(0,t.jsx)(Ze.Z,{}),(0,t.jsx)("div",{style:{marginTop:8},children:"Upload"})]});return(0,p.useEffect)(function(){var C=function(){var I=D()(v()().mark(function T(){var g;return v()().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:if(a){j.next=2;break}return j.abrupt("return");case 2:return j.next=4,De(a);case 4:g=j.sent,g.success&&E(g.data);case 6:case"end":return j.stop()}},T)}));return function(){return I.apply(this,arguments)}}();C()},[a]),l?(0,t.jsx)(te.Z,{src:b,width:32}):(0,t.jsx)(Fe.Z,{name:"avatar",listType:"picture-card",className:"avatar-uploader",showUploadList:!1,openFileDialogOnClick:!b,beforeUpload:we,onChange:R,children:b?(0,t.jsx)(te.Z,{src:b}):B})},ne=Le,K=e(36704),Q=e(47934),Me=e(79412),se=e(96682),Ue=e(65590),Ae=e(19050),ue=e(88539),Ge=e(99255),ie=e(20933),$e=e(30280),X=e(34825),We=e(73193),V=e.n(We),Ke=e(85045),Ve=e.n(Ke),$=e(92259),H=e(88251),He=e(9425),Ne=e(10034),le={cursor:"move",transition:"unset"},ze=function(u){var a=u.tag,r=(0,H.nB)({id:a.id}),l=r.listeners,s=r.transform,m=r.transition,f=r.isDragging,S=r.setNodeRef,n=s?V()(V()({},le),{},{transform:"translate3d(".concat(s.x,"px, ").concat(s.y,"px, 0)"),transition:f?"unset":m}):le;return(0,t.jsx)(He.Z,V()(V()({style:n,ref:S},l),{},{children:a.text}))},ke=function(u){var a=u.data,r=u.disabled,l=a.tags,s=(0,p.useState)([{id:1,text:"Tag 1"},{id:2,text:"Tag 2"},{id:3,text:"Tag 3"}]),m=x()(s,2),f=m[0],S=m[1];(0,p.useEffect)(function(){var b=function(){var E=D()(v()().mark(function R(){var B,C,I,T,g,Z,j,h;return v()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:B=[],C=!1,I=!1,c.prev=3,g=Ve()(l);case 5:return c.next=7,g.next();case 7:if(!(C=!(Z=c.sent).done)){c.next=16;break}return j=Z.value,c.next=11,Q.q.tag.get(j);case 11:h=c.sent,h&&B.push({id:h.id,text:h.title});case 13:C=!1,c.next=5;break;case 16:c.next=22;break;case 18:c.prev=18,c.t0=c.catch(3),I=!0,T=c.t0;case 22:if(c.prev=22,c.prev=23,!(C&&g.return!=null)){c.next=27;break}return c.next=27,g.return();case 27:if(c.prev=27,!I){c.next=30;break}throw T;case 30:return c.finish(27);case 31:return c.finish(22);case 32:S(B);case 33:case"end":return c.stop()}},R,null,[[3,18,22,32],[23,,27,31]])}));return function(){return E.apply(this,arguments)}}();b()},[l]);var n=(0,$.Dy)((0,$.VT)($.we)),w=function(E){var R=E.active,B=E.over;B&&R.id!==B.id&&S(function(C){var I=C.findIndex(function(g){return g.id===R.id}),T=C.findIndex(function(g){return g.id===B.id});return(0,H.Rp)(C,I,T)})};return(0,p.useEffect)(function(){if(l.length===f.length){var b=f.map(function(E){return E.id});b.join()!==l.join()&&K.O.web.update(a.id,{tags:b})}},[f,l,a]),(0,t.jsx)($.LB,{sensors:n,onDragEnd:w,collisionDetection:$.pE,children:(0,t.jsx)(H.Fo,{disabled:r,items:f,strategy:H.PG,children:(0,t.jsx)(Ne.Z,{gap:"4px 0",wrap:!0,children:f.map(function(b){return(0,t.jsx)(ze,{tag:b},b.id)})})})})},Ye=ke,Je=function(){var y=D()(v()().mark(function u(a){var r;return v()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return r=G.ZP.loading("\u6B63\u5728\u6DFB\u52A0"),s.prev=1,s.next=4,K.O.web.put(a);case 4:return r(),G.ZP.success("\u6DFB\u52A0\u6210\u529F"),s.abrupt("return",!0);case 9:return s.prev=9,s.t0=s.catch(1),r(),G.ZP.error("\u6DFB\u52A0\u5931\u8D25\u8BF7\u91CD\u8BD5\uFF01"),s.abrupt("return",!1);case 14:case"end":return s.stop()}},u,null,[[1,9]])}));return function(a){return y.apply(this,arguments)}}(),Qe=function(){var u=(0,X.yR)(function(){return K.O.web.toArray()},[]),a=(0,X.yR)(function(){return Q.q.tag.orderBy("order").toArray()},[]),r=(0,X.yR)(function(){return Q.q.group.orderBy("order").toArray()},[]),l=(0,p.useMemo)(function(){return r==null?void 0:r.map(function(i){return{title:i.title,value:"group-"+i.id,disabled:!0,children:a==null?void 0:a.filter(function(o){return o.group===i.id}).map(function(o){return{title:o.title,value:o.id}})}}).filter(function(i){var o;return(o=i.children)===null||o===void 0?void 0:o.length})},[a,r]),s=(0,p.useState)(!1),m=x()(s,2),f=m[0],S=m[1],n=(0,p.useState)(),w=x()(n,2),b=w[0],E=w[1],R=function(o){E(o),S(!0)};(0,p.useEffect)(function(){f||E(void 0)},[f]);var B=(0,p.useState)(!1),C=x()(B,2),I=C[0],T=C[1],g=function(o){T(o.target.checked)},Z=(0,p.useState)(!1),j=x()(Z,2),h=j[0],oe=j[1],c=function(o){oe(o.target.checked)};console.log("operateChecked",h);var qe=(0,p.useState)(),de=x()(qe,2),L=de[0],ce=de[1],q=(0,p.useRef)(),_=[{title:"id",dataIndex:"id",hideInTable:!0,hideInSearch:!0,formItemProps:{hidden:!0},fieldProps:{disabled:!0}},{title:"\u56FE\u6807",dataIndex:"icon",hideInSearch:!0,renderFormItem:function(){return(0,t.jsx)(ne,{})},render:function(o,d,P,F,O){return(0,t.jsx)(ne,{value:d.icon,onlyPreview:!0})}},{title:"\u6807\u9898",dataIndex:"title",formItemProps:{rules:[{required:!0,message:"\u540D\u79F0\u4E3A\u5FC5\u586B\u9879"}]},render:function(o,d){return(0,t.jsx)("span",{className:"cursor-pointer",onClick:function(){return(0,ae.ZK)(d.url)},children:d.title})}},{title:"\u526F\u6807\u9898",dataIndex:"subTitle",hideInSearch:!0},{title:"\u7F51\u5740",dataIndex:"url",formItemProps:{rules:[{required:!0,message:"\u7F51\u5740\u4E3A\u5FC5\u586B\u9879"}]},render:function(o,d){return(0,t.jsx)(Ae.Z.Text,{copyable:{text:d.url},children:d.url})}},{title:"tags",dataIndex:"tags",valueType:"treeSelect",fieldProps:{treeData:l,multiple:!0,showSearch:!0,rules:[{required:!0,message:"tags\u5FC5\u586B\u9879"}]},render:function(o,d){return(0,t.jsx)(Ye,{data:d,disabled:!I})}},{title:"\u5907\u6CE8",dataIndex:"remark",valueType:"textarea"},{title:"\u64CD\u4F5C",dataIndex:"option",valueType:"option",fixed:h?"right":!1,width:"160px",render:function(o,d){return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("a",{href:d.url,target:"_black",rel:"noreferrer",children:"\u8DF3\u8F6C"}),(0,t.jsx)(ue.Z,{type:"vertical"}),(0,t.jsx)("a",{onClick:function(){return R(d)},children:"\u7F16\u8F91"}),(0,t.jsx)(ue.Z,{type:"vertical"}),(0,t.jsx)("a",{onClick:function(){return ce(d)},children:"\u8BE6\u60C5"})]})}}];(0,p.useEffect)(function(){K.O.getCloudData()},[]);var _e=(0,p.useState)({}),fe=x()(_e,2),U=fe[0],he=fe[1],er=(0,p.useState)([]),ve=x()(er,2),rr=ve[0],ar=ve[1];return(0,p.useEffect)(function(){var i=u||[],o=Object.keys(U);o.length&&o.forEach(function(d){switch(d){case"title":i=i.filter(function(P){var F;return P.title.includes(U[d]||"")||((F=P.subTitle)===null||F===void 0?void 0:F.includes(U[d]||""))});break;case"url":i=i.filter(function(P){return P.url.includes(U[d]||"")});break;case"tags":i=i.filter(function(P){var F=U[d];return F?F.every(function(O){return P.tags.includes(O)}):!0});break;default:break}}),ar(i)},[u,U]),(0,t.jsxs)(Me._z,{children:[(0,t.jsx)(se.Z,{headerTitle:"\u67E5\u8BE2\u8868\u683C",actionRef:q,rowKey:"id",search:{labelWidth:80},scroll:{x:"max-content"},toolBarRender:function(){return[(0,t.jsx)(Ge.ZP,{type:"primary",onClick:function(){return S(!0)},children:"\u65B0\u5EFA"},"1"),(0,t.jsx)(ie.Z,{checked:I,onChange:g,children:"tag"}),(0,t.jsx)(ie.Z,{checked:h,onChange:c,children:"\u64CD\u4F5C"})]},options:{fullScreen:!0,reload:!1},dataSource:rr,columns:_,onSubmit:he,onReset:function(){return he({})}},"".concat(h)),(0,t.jsx)(ee.Z,{title:b&&"\u7F16\u8F91 - ".concat(b.id),onCancel:function(){return S(!1)},modalVisible:f,children:(0,t.jsx)(se.Z,{onSubmit:function(){var i=D()(v()().mark(function o(d){var P;return v()().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return O.next=2,Je(d);case 2:P=O.sent,P&&(S(!1),q.current&&q.current.reload());case 4:case"end":return O.stop()}},o)}));return function(o){return i.apply(this,arguments)}}(),rowKey:"id",type:"form",columns:_,form:{initialValues:b}})}),(0,t.jsx)($e.Z,{width:600,open:!!L,onClose:function(){ce(void 0)},closable:!0,children:L&&(0,t.jsx)(Ue.vY,{column:2,title:L.title,request:D()(v()().mark(function i(){return v()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.abrupt("return",{data:L||{}});case 1:case"end":return d.stop()}},i)})),params:{id:L==null?void 0:L.id},columns:_})})]})},Xe=Qe}}]);
