"use strict";(self.webpackChunkapps_ant_admin=self.webpackChunkapps_ant_admin||[]).push([[462],{24936:function(te,G,e){var K=e(73193),B=e.n(K),H=e(97190),m=e(44194),z=e(31549),F=function(U){var N=U.modalVisible,J=U.children;return(0,z.jsx)(H.Z,B()(B()({destroyOnClose:!0,title:"\u65B0\u5EFA",width:"80vw",open:N,footer:null},U),{},{children:J}))};G.Z=F},61158:function(te,G,e){e.r(G),e.d(G,{default:function(){return we}});var K=e(45332),B=e.n(K),H=e(90819),m=e.n(H),z=e(89933),F=e.n(z),X=e(24936),U=e(4977),N=e.n(U),J=e(78796),ne=e.n(J),se=e(41553),ue=e.n(se),ie=e(49488),le=e.n(ie),oe=e(84047),de=e.n(oe),fe=e(10154),ce=e.n(fe),ve=e(99338),he=function(g){le()(a,g);var s=de()(a);function a(){var r;return ne()(this,a),r=s.call(this,"HashDB"),ce()(ue()(r),"hash",void 0),r.version(1).stores({hash:"&hash"}),r}return N()(a)}(ve.ZP),M=new he,me=function(){var g=F()(m()().mark(function s(){return m()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:case"end":return r.stop()}},s)}));return function(){return g.apply(this,arguments)}}();M.on("populate",me),window.hashDb=M;var k=e(51264),pe=function(){var g=F()(m()().mark(function s(a){var r,l,n,f,d=arguments;return m()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=d.length>1&&d[1]!==void 0?d[1]:"img",t.next=3,M.hash.get(a);case 3:if(l=t.sent,l!=null&&l.base64){t.next=14;break}return t.next=7,(0,k.I)({path:"hash/".concat(r,"/").concat(a),autoCreate:!1});case 7:if(n=t.sent,!n.success){t.next=13;break}return f=n.data.content,t.next=12,M.hash.put({hash:a,base64:f});case 12:return t.abrupt("return",{status:200,success:!0,data:f});case 13:return t.abrupt("return",n);case 14:return t.abrupt("return",{status:200,success:!0,data:l.base64});case 15:case"end":return t.stop()}},s)}));return function(a){return g.apply(this,arguments)}}(),ge=function(){var g=F()(m()().mark(function s(a){var r,l,n,f,d;return m()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=a.hash,l=a.content,n=a.type,f=n===void 0?"img":n,t.next=3,M.hash.get(r);case 3:if(d=t.sent,d!=null&&d.hash){t.next=10;break}return t.next=7,M.hash.put({hash:r,base64:l});case 7:return t.next=9,(0,k.I)({path:"hash/".concat(f,"/").concat(r),content:l,autoCreate:!0});case 9:return t.abrupt("return",t.sent);case 10:return t.abrupt("return",{status:200,success:!0,data:d.base64});case 11:case"end":return t.stop()}},s)}));return function(a){return g.apply(this,arguments)}}(),be=e(94e3),ye=e(87660),Te=e(67247),w=e(25248),q=e(16478),Se=e(34934),p=e(44194),u=e(31549),je=function(s){return new Promise(function(a,r){var l=new FileReader;l.readAsDataURL(s),l.onload=function(){return a(l.result)},l.onerror=function(n){return r(n)}})},Ie=function(s){var a=["image/jpeg","image/png","image/svg+xml"].includes(s.type);a||w.ZP.error("You can only upload JPG/PNG/SVG file!");var r=s.size/1024/1024<2;return r||w.ZP.error("Image must smaller than 2MB!"),!1},Pe=function(s){var a=s.value,r=s.onChange,l=s.onlyPreview,n=(0,p.useState)(!1),f=B()(n,2),d=f[0],P=f[1],t=(0,p.useState)(),T=B()(t,2),b=T[0],C=T[1],D=function(){var E=F()(m()().mark(function x(c){var h,O;return m()().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:if(!d){j.next=2;break}return j.abrupt("return");case 2:return P(!0),console.log("info",c),j.next=6,je(c.file.originFileObj||c.file);case 6:return h=j.sent,C(h),j.next=10,(0,Te.x5)(h);case 10:return O=j.sent,j.next=13,ge({hash:O,content:h,type:c.file.name.split(".").at(-1)});case 13:r==null||r(O),P(!1);case 15:case"end":return j.stop()}},x)}));return function(c){return E.apply(this,arguments)}}(),S=(0,u.jsxs)("button",{style:{border:0,background:"none"},type:"button",children:[d?(0,u.jsx)(be.Z,{}):(0,u.jsx)(ye.Z,{}),(0,u.jsx)("div",{style:{marginTop:8},children:"Upload"})]});return(0,p.useEffect)(function(){var E=function(){var x=F()(m()().mark(function c(){var h;return m()().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:if(a){y.next=2;break}return y.abrupt("return");case 2:return y.next=4,pe(a);case 4:h=y.sent,h.success&&C(h.data);case 6:case"end":return y.stop()}},c)}));return function(){return x.apply(this,arguments)}}();E()},[a]),l?(0,u.jsx)(q.Z,{src:b,width:32}):(0,u.jsx)(Se.Z,{name:"avatar",listType:"picture-card",className:"avatar-uploader",showUploadList:!1,openFileDialogOnClick:!b,beforeUpload:Ie,onChange:D,children:b?(0,u.jsx)(q.Z,{src:b}):S})},_=Pe,$=e(36704),Y=e(47934),Ee=e(79412),ee=e(75813),re=e(88539),Ce=e(99255),Q=e(34825),De=e(73193),W=e.n(De),xe=e(85045),Re=e.n(xe),A=e(92259),V=e(88251),Be=e(9425),Fe=e(10034),ae={cursor:"move",transition:"unset"},Oe=function(s){var a=s.tag,r=(0,V.nB)({id:a.id}),l=r.listeners,n=r.transform,f=r.transition,d=r.isDragging,P=r.setNodeRef,t=n?W()(W()({},ae),{},{transform:"translate3d(".concat(n.x,"px, ").concat(n.y,"px, 0)"),transition:d?"unset":f}):ae;return(0,u.jsx)(Be.Z,W()(W()({style:t,ref:P},l),{},{children:a.text}))},Ze=function(s){var a=s.data,r=a.tags,l=(0,p.useState)([{id:1,text:"Tag 1"},{id:2,text:"Tag 2"},{id:3,text:"Tag 3"}]),n=B()(l,2),f=n[0],d=n[1];(0,p.useEffect)(function(){var T=function(){var b=F()(m()().mark(function C(){var D,S,E,x,c,h,O,y;return m()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:D=[],S=!1,E=!1,i.prev=3,c=Re()(r);case 5:return i.next=7,c.next();case 7:if(!(S=!(h=i.sent).done)){i.next=16;break}return O=h.value,i.next=11,Y.q.tag.get(O);case 11:y=i.sent,y&&D.push({id:y.id,text:y.title});case 13:S=!1,i.next=5;break;case 16:i.next=22;break;case 18:i.prev=18,i.t0=i.catch(3),E=!0,x=i.t0;case 22:if(i.prev=22,i.prev=23,!(S&&c.return!=null)){i.next=27;break}return i.next=27,c.return();case 27:if(i.prev=27,!E){i.next=30;break}throw x;case 30:return i.finish(27);case 31:return i.finish(22);case 32:d(D);case 33:case"end":return i.stop()}},C,null,[[3,18,22,32],[23,,27,31]])}));return function(){return b.apply(this,arguments)}}();T()},[r]);var P=(0,A.Dy)((0,A.VT)(A.we)),t=function(b){var C=b.active,D=b.over;D&&C.id!==D.id&&d(function(S){var E=S.findIndex(function(c){return c.id===C.id}),x=S.findIndex(function(c){return c.id===D.id});return(0,V.Rp)(S,E,x)})};return(0,p.useEffect)(function(){if(r.length===f.length){var T=f.map(function(b){return b.id});T.join()!==r.join()&&$.O.web.update(a.id,{tags:T})}},[f,r,a]),(0,u.jsx)(A.LB,{sensors:P,onDragEnd:t,collisionDetection:A.pE,children:(0,u.jsx)(V.Fo,{items:f,strategy:V.PG,children:(0,u.jsx)(Fe.Z,{gap:"4px 0",wrap:!0,children:f.map(function(T){return(0,u.jsx)(Oe,{tag:T},T.id)})})})})},Le=Ze,Me=function(){var g=F()(m()().mark(function s(a){var r;return m()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=w.ZP.loading("\u6B63\u5728\u6DFB\u52A0"),n.prev=1,n.next=4,$.O.web.put(a);case 4:return r(),w.ZP.success("\u6DFB\u52A0\u6210\u529F"),n.abrupt("return",!0);case 9:return n.prev=9,n.t0=n.catch(1),r(),w.ZP.error("\u6DFB\u52A0\u5931\u8D25\u8BF7\u91CD\u8BD5\uFF01"),n.abrupt("return",!1);case 14:case"end":return n.stop()}},s,null,[[1,9]])}));return function(a){return g.apply(this,arguments)}}(),Ue=function(){var s=(0,Q.yR)(function(){return $.O.web.toArray()},[]),a=(0,Q.yR)(function(){return Y.q.tag.orderBy("order").toArray()},[]),r=(0,Q.yR)(function(){return Y.q.group.orderBy("order").toArray()},[]),l=(0,p.useMemo)(function(){return r==null?void 0:r.map(function(o){return{title:o.title,value:"group-"+o.id,disabled:!0,children:a==null?void 0:a.filter(function(v){return v.group===o.id}).map(function(v){return{title:v.title,value:v.id}})}}).filter(function(o){var v;return(v=o.children)===null||v===void 0?void 0:v.length})},[a,r]),n=(0,p.useState)(!1),f=B()(n,2),d=f[0],P=f[1],t=(0,p.useState)(),T=B()(t,2),b=T[0],C=T[1],D=function(v){C(v),P(!0)};(0,p.useEffect)(function(){d||C(void 0)},[d]);var S=(0,p.useRef)(),E=[{title:"id",dataIndex:"id",hideInTable:!0,hideInSearch:!0,formItemProps:{hidden:!0},fieldProps:{disabled:!0}},{title:"\u56FE\u6807",dataIndex:"icon",hideInSearch:!0,renderFormItem:function(){return(0,u.jsx)(_,{})},render:function(v,I,R,Z,L){return(0,u.jsx)(_,{value:I.icon,onlyPreview:!0})}},{title:"\u6807\u9898",dataIndex:"title",formItemProps:{rules:[{required:!0,message:"\u540D\u79F0\u4E3A\u5FC5\u586B\u9879"}]}},{title:"\u526F\u6807\u9898",dataIndex:"subTitle",hideInSearch:!0},{title:"\u7F51\u5740",dataIndex:"url",formItemProps:{rules:[{required:!0,message:"\u7F51\u5740\u4E3A\u5FC5\u586B\u9879"}]}},{title:"tags",dataIndex:"tags",valueType:"treeSelect",fieldProps:{treeData:l,multiple:!0,showSearch:!0,rules:[{required:!0,message:"tags\u5FC5\u586B\u9879"}]},render:function(v,I){return(0,u.jsx)(Le,{data:I})}},{title:"\u5907\u6CE8",dataIndex:"remark",valueType:"textarea"},{title:"\u64CD\u4F5C",dataIndex:"option",valueType:"option",fixed:"right",width:"160px",render:function(v,I){return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("a",{href:I.url,target:"_black",rel:"noreferrer",children:"\u8DF3\u8F6C"}),(0,u.jsx)(re.Z,{type:"vertical"}),(0,u.jsx)("a",{onClick:function(){return D(I)},children:"\u7F16\u8F91"}),(0,u.jsx)(re.Z,{type:"vertical"}),(0,u.jsx)("a",{children:"\u5220\u9664"})]})}}];(0,p.useEffect)(function(){$.O.getCloudData()},[]);var x=(0,p.useState)({}),c=B()(x,2),h=c[0],O=c[1],y=(0,p.useState)([]),j=B()(y,2),i=j[0],Ae=j[1];return(0,p.useEffect)(function(){var o=s||[],v=Object.keys(h);v.length&&v.forEach(function(I){switch(I){case"title":o=o.filter(function(R){var Z;return R.title.includes(h[I]||"")||((Z=R.subTitle)===null||Z===void 0?void 0:Z.includes(h[I]||""))});break;case"url":o=o.filter(function(R){return R.url.includes(h[I]||"")});break;case"tags":o=o.filter(function(R){var Z=h[I];return Z?Z.every(function(L){return R.tags.includes(L)}):!0});break;default:break}}),Ae(o)},[s,h]),(0,u.jsxs)(Ee._z,{children:[(0,u.jsx)(ee.Z,{headerTitle:"\u67E5\u8BE2\u8868\u683C",actionRef:S,rowKey:"id",search:{labelWidth:80},scroll:{x:"max-content"},toolBarRender:function(){return[(0,u.jsx)(Ce.ZP,{type:"primary",onClick:function(){return P(!0)},children:"\u65B0\u5EFA"},"1")]},dataSource:i,columns:E,onSubmit:O,onReset:function(){return O({})}}),(0,u.jsx)(X.Z,{title:b&&"\u7F16\u8F91 - ".concat(b.id),onCancel:function(){return P(!1)},modalVisible:d,children:(0,u.jsx)(ee.Z,{onSubmit:function(){var o=F()(m()().mark(function v(I){var R;return m()().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return L.next=2,Me(I);case 2:R=L.sent,R&&(P(!1),S.current&&S.current.reload());case 4:case"end":return L.stop()}},v)}));return function(v){return o.apply(this,arguments)}}(),rowKey:"id",type:"form",columns:E,form:{initialValues:b}})})]})},we=Ue}}]);
