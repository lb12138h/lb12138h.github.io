"use strict";(self.webpackChunkapps_ant_admin=self.webpackChunkapps_ant_admin||[]).push([[462],{98369:function(ve,V,e){var Q=e(73193),_=e.n(Q),X=e(98421),g=e(44194),q=e(31549),j=function(C){var K=C.modalVisible,N=C.children;return(0,q.jsx)(X.Z,_()(_()({destroyOnClose:!0,title:"\u65B0\u5EFA",width:"80vw",open:K,footer:null},C),{},{children:N}))};V.Z=j},37453:function(ve,V,e){e.d(V,{Z:function(){return A}});var Q=e(90819),_=e.n(Q),X=e(89933),g=e.n(X),q=e(45332),j=e.n(q),se=e(4977),C=e.n(se),K=e(78796),N=e.n(K),ie=e(41553),ue=e.n(ie),S=e(49488),H=e.n(S),ee=e(84047),_e=e.n(ee),z=e(10154),w=e.n(z),re=e(99338),de=function(h){H()(o,h);var n=_e()(o);function o(){var t;return N()(this,o),t=n.call(this,"HashDB"),w()(ue()(t),"hash",void 0),t.version(1).stores({hash:"&hash"}),t}return C()(o)}(re.ZP),R=new de,v=function(){var h=g()(_()().mark(function n(){return _()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},n)}));return function(){return h.apply(this,arguments)}}();R.on("populate",v),window.hashDb=R;var Z=e(4931),a=function(){var h=g()(_()().mark(function n(o){var t,d,p,r,D=arguments;return _()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return t=D.length>1&&D[1]!==void 0?D[1]:"img",s.next=3,R.hash.get(o);case 3:if(d=s.sent,d!=null&&d.base64){s.next=14;break}return s.next=7,(0,Z.I)({path:"hash/".concat(t,"/").concat(o),autoCreate:!1});case 7:if(p=s.sent,!p.success){s.next=13;break}return r=p.data.content,s.next=12,R.hash.put({hash:o,base64:r});case 12:return s.abrupt("return",{status:200,success:!0,data:r});case 13:return s.abrupt("return",p);case 14:return s.abrupt("return",{status:200,success:!0,data:d.base64});case 15:case"end":return s.stop()}},n)}));return function(o){return h.apply(this,arguments)}}(),x=function(){var h=g()(_()().mark(function n(o){var t,d,p,r,D;return _()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return t=o.hash,d=o.content,p=o.type,r=p===void 0?"img":p,s.next=3,R.hash.get(t);case 3:if(D=s.sent,D!=null&&D.hash){s.next=10;break}return s.next=7,R.hash.put({hash:t,base64:d});case 7:return s.next=9,(0,Z.I)({path:"hash/".concat(r,"/").concat(t),content:d,autoCreate:!0});case 9:return s.abrupt("return",s.sent);case 10:return s.abrupt("return",{status:200,success:!0,data:D.base64});case 11:case"end":return s.stop()}},n)}));return function(o){return h.apply(this,arguments)}}(),Y=e(94e3),f=e(87660),y=e(37138),P=e(79044),c=e(60416),F=e(8010),b=e(51865),oe=e.n(b),E=e(44194),m=e(31549),G=function(n){return new Promise(function(o,t){var d=new FileReader;d.readAsDataURL(n),d.onload=function(){return o(d.result)},d.onerror=function(p){return t(p)}})},B=function(n){var o=["image/jpeg","image/png","image/svg+xml"].includes(n.type);o||P.ZP.error("You can only upload JPG/PNG/SVG file!");var t=n.size/1024/1024<2;return t||P.ZP.error("Image must smaller than 2MB!"),!1},M=function(n){var o=n.value,t=n.onChange,d=n.onlyPreview,p=n.className,r=(0,E.useState)(!1),D=j()(r,2),$=D[0],s=D[1],fe=(0,E.useState)(),me=j()(fe,2),ne=me[0],L=me[1],he=function(){var ae=g()(_()().mark(function le(U){var O,te;return _()().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:if(!$){T.next=2;break}return T.abrupt("return");case 2:return s(!0),console.log("info",U),T.next=6,G(U.file.originFileObj||U.file);case 6:return O=T.sent,L(O),T.next=10,(0,y.x5)(O);case 10:return te=T.sent,T.next=13,x({hash:te,content:O});case 13:t==null||t(te),s(!1);case 15:case"end":return T.stop()}},le)}));return function(U){return ae.apply(this,arguments)}}(),ce=(0,m.jsxs)("button",{style:{border:0,background:"none"},type:"button",children:[$?(0,m.jsx)(Y.Z,{}):(0,m.jsx)(f.Z,{}),(0,m.jsx)("div",{style:{marginTop:8},children:"Upload"})]});return(0,E.useEffect)(function(){var ae=function(){var le=g()(_()().mark(function U(){var O;return _()().wrap(function(W){for(;;)switch(W.prev=W.next){case 0:if(o){W.next=2;break}return W.abrupt("return");case 2:return W.next=4,a(o);case 4:O=W.sent,O.success&&L(O.data);case 6:case"end":return W.stop()}},U)}));return function(){return le.apply(this,arguments)}}();ae()},[o]),d?(0,m.jsx)(c.Z,{className:p,src:ne,width:32}):(0,m.jsx)(F.Z,{name:"avatar",listType:"picture-card",className:oe()("avatar-uploader",p),showUploadList:!1,openFileDialogOnClick:!ne,beforeUpload:B,onChange:he,children:ne?(0,m.jsx)(c.Z,{src:ne}):ce})},A=M},94665:function(ve,V,e){var Q=e(90819),_=e.n(Q),X=e(89933),g=e.n(X),q=e(45332),j=e.n(q),se=e(73193),C=e.n(se),K=e(85045),N=e.n(K),ie=e(16493),ue=e(95836),S=e(92259),H=e(88251),ee=e(8504),_e=e(13221),z=e(44194),w=e(31549),re={cursor:"move",transition:"unset"},de=function(Z){var a=Z.tag,x=(0,H.nB)({id:a.id}),Y=x.listeners,f=x.transform,y=x.transition,P=x.isDragging,c=x.setNodeRef,F=f?C()(C()({},re),{},{transform:"translate3d(".concat(f.x,"px, ").concat(f.y,"px, 0)"),transition:P?"unset":y}):re;return(0,w.jsx)(ee.Z,C()(C()({style:F,ref:c},Y),{},{children:a.text}))},R=function(Z){var a=Z.data,x=Z.disabled,Y=a.tags,f=Y===void 0?[]:Y,y=(0,z.useState)([{id:1,text:"Tag 1"},{id:2,text:"Tag 2"},{id:3,text:"Tag 3"}]),P=j()(y,2),c=P[0],F=P[1];(0,z.useEffect)(function(){var E=function(){var m=g()(_()().mark(function G(){var B,M,A,h,n,o,t,d;return _()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:B=[],M=!1,A=!1,r.prev=3,n=N()(f);case 5:return r.next=7,n.next();case 7:if(!(M=!(o=r.sent).done)){r.next=16;break}return t=o.value,r.next=11,ue.q.tag.get(t);case 11:d=r.sent,d&&B.push({id:d.id,text:d.title});case 13:M=!1,r.next=5;break;case 16:r.next=22;break;case 18:r.prev=18,r.t0=r.catch(3),A=!0,h=r.t0;case 22:if(r.prev=22,r.prev=23,!(M&&n.return!=null)){r.next=27;break}return r.next=27,n.return();case 27:if(r.prev=27,!A){r.next=30;break}throw h;case 30:return r.finish(27);case 31:return r.finish(22);case 32:F(B);case 33:case"end":return r.stop()}},G,null,[[3,18,22,32],[23,,27,31]])}));return function(){return m.apply(this,arguments)}}();E()},[f]);var b=(0,S.Dy)((0,S.VT)(S.we)),oe=function(m){var G=m.active,B=m.over;B&&G.id!==B.id&&F(function(M){var A=M.findIndex(function(n){return n.id===G.id}),h=M.findIndex(function(n){return n.id===B.id});return(0,H.Rp)(M,A,h)})};return(0,z.useEffect)(function(){if((f==null?void 0:f.length)===c.length){var E=c.map(function(m){return m.id});E.join()!==f.join()&&ie.O.web.update(a.id,{tags:E})}},[c,f,a]),(0,w.jsx)(S.LB,{sensors:b,onDragEnd:oe,collisionDetection:S.pE,children:(0,w.jsx)(H.Fo,{disabled:x,items:c,strategy:H.PG,children:(0,w.jsx)(_e.Z,{gap:"4px 0",wrap:!0,children:c.map(function(E){return(0,w.jsx)(de,{tag:E},E.id)})})})})};V.Z=R},4549:function(ve,V,e){e.r(V);var Q=e(45332),_=e.n(Q),X=e(90819),g=e.n(X),q=e(89933),j=e.n(q),se=e(98369),C=e(37453),K=e(16493),N=e(95836),ie=e(63969),ue=e(75255),S=e(70849),H=e(37138),ee=e(79044),_e=e(64607),z=e(13459),w=e(64103),re=e(2037),de=e(41779),R=e(34825),v=e(44194),Z=e(94665),a=e(31549),x=function(){var f=j()(g()().mark(function y(P){var c;return g()().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return c=ee.ZP.loading("\u6B63\u5728\u6DFB\u52A0"),b.prev=1,b.next=4,K.O.web.put(P);case 4:return c(),ee.ZP.success("\u6DFB\u52A0\u6210\u529F"),b.abrupt("return",!0);case 9:return b.prev=9,b.t0=b.catch(1),c(),ee.ZP.error("\u6DFB\u52A0\u5931\u8D25\u8BF7\u91CD\u8BD5\uFF01"),b.abrupt("return",!1);case 14:case"end":return b.stop()}},y,null,[[1,9]])}));return function(P){return f.apply(this,arguments)}}(),Y=function(){var y=(0,R.yR)(function(){return K.O.web.toArray()},[]),P=(0,R.yR)(function(){return N.q.tag.orderBy("order").toArray()},[]),c=(0,R.yR)(function(){return N.q.group.orderBy("order").toArray()},[]),F=(0,v.useMemo)(function(){return c==null?void 0:c.map(function(u){return{title:u.title,value:"group-"+u.id,disabled:!0,children:P==null?void 0:P.filter(function(l){return l.group===u.id}).map(function(l){return{title:l.title,value:l.id}})}}).filter(function(u){var l;return(l=u.children)===null||l===void 0?void 0:l.length})},[P,c]),b=(0,v.useState)(!1),oe=_()(b,2),E=oe[0],m=oe[1],G=(0,v.useState)(),B=_()(G,2),M=B[0],A=B[1],h=function(l){A(l),m(!0)};(0,v.useEffect)(function(){E||A(void 0)},[E]);var n=(0,v.useState)(!1),o=_()(n,2),t=o[0],d=o[1],p=function(l){d(l.target.checked)},r=(0,v.useState)(!1),D=_()(r,2),$=D[0],s=D[1],fe=function(l){s(l.target.checked)};console.log("operateChecked",$);var me=(0,v.useState)(),ne=_()(me,2),L=ne[0],he=ne[1],ce=(0,v.useRef)(),ae=[{title:"id",dataIndex:"id",hideInTable:!0,hideInSearch:!0,formItemProps:{hidden:!0},fieldProps:{disabled:!0}},{title:"\u56FE\u6807",dataIndex:"icon",hideInSearch:!0,renderFormItem:function(){return(0,a.jsx)(C.Z,{})},render:function(l,i,I,J,k){return(0,a.jsx)(C.Z,{value:i.icon,onlyPreview:!0})}},{title:"\u6807\u9898",dataIndex:"title",formItemProps:{rules:[{required:!0,message:"\u540D\u79F0\u4E3A\u5FC5\u586B\u9879"}]},render:function(l,i){return(0,a.jsx)("span",{className:"cursor-pointer",onClick:function(){return(0,H.ZK)(i.url)},children:i.title})}},{title:"\u526F\u6807\u9898",dataIndex:"subTitle",hideInSearch:!0},{title:"\u7F51\u5740",dataIndex:"url",formItemProps:{rules:[{required:!0,message:"\u7F51\u5740\u4E3A\u5FC5\u586B\u9879"}]},render:function(l,i){return(0,a.jsx)(_e.Z.Text,{copyable:{text:i.url},children:i.url})}},{title:"tags",dataIndex:"tags",valueType:"treeSelect",fieldProps:{treeData:F,multiple:!0,showSearch:!0,rules:[{required:!0,message:"tags\u5FC5\u586B\u9879"}]},render:function(l,i){return(0,a.jsx)(Z.Z,{data:i,disabled:!t})}},{title:"\u5907\u6CE8",dataIndex:"remark",valueType:"textarea"},{title:"\u64CD\u4F5C",dataIndex:"option",valueType:"option",fixed:$?"right":!1,width:"160px",render:function(l,i){return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("a",{href:i.url,target:"_black",rel:"noreferrer",children:"\u8DF3\u8F6C"}),(0,a.jsx)(z.Z,{type:"vertical"}),(0,a.jsx)("a",{onClick:function(){return h(i)},children:"\u7F16\u8F91"}),(0,a.jsx)(z.Z,{type:"vertical"}),(0,a.jsx)("a",{onClick:function(){return he(i)},children:"\u8BE6\u60C5"})]})}}];(0,v.useEffect)(function(){K.O.getCloudData()},[]);var le=(0,v.useState)({}),U=_()(le,2),O=U[0],te=U[1],W=(0,v.useState)([]),T=_()(W,2),be=T[0],Ee=T[1];return(0,v.useEffect)(function(){var u=y||[],l=Object.keys(O);l.length&&l.forEach(function(i){switch(i){case"title":u=u.filter(function(I){var J;return I.title.includes(O[i]||"")||((J=I.subTitle)===null||J===void 0?void 0:J.includes(O[i]||""))});break;case"url":u=u.filter(function(I){return I.url.includes(O[i]||"")});break;case"tags":u=u.filter(function(I){var J=O[i];return J?J.every(function(k){return I.tags.includes(k)}):!0});break;default:break}}),Ee(u)},[y,O]),(0,a.jsxs)(ie._z,{children:[(0,a.jsx)(ue.Z,{headerTitle:"\u67E5\u8BE2\u8868\u683C",actionRef:ce,rowKey:"id",search:{labelWidth:80},scroll:{x:"max-content"},toolBarRender:function(){return[(0,a.jsx)(w.ZP,{type:"primary",onClick:function(){return m(!0)},children:"\u65B0\u5EFA"},"1"),(0,a.jsx)(re.Z,{checked:t,onChange:p,children:"tag"}),(0,a.jsx)(re.Z,{checked:$,onChange:fe,children:"\u64CD\u4F5C"})]},options:{fullScreen:!0,reload:!1},dataSource:be,columns:ae,onSubmit:te,onReset:function(){return te({})}},"".concat($)),(0,a.jsx)(se.Z,{title:M&&"\u7F16\u8F91 - ".concat(M.id),onCancel:function(){return m(!1)},modalVisible:E,children:(0,a.jsx)(ue.Z,{onSubmit:function(){var u=j()(g()().mark(function l(i){var I;return g()().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return k.next=2,x(i);case 2:I=k.sent,I&&(m(!1),ce.current&&ce.current.reload());case 4:case"end":return k.stop()}},l)}));return function(l){return u.apply(this,arguments)}}(),rowKey:"id",type:"form",columns:ae,form:{initialValues:M}})}),(0,a.jsx)(de.Z,{width:600,open:!!L,onClose:function(){he(void 0)},closable:!0,children:L&&(0,a.jsx)(S.vY,{column:2,title:L.title,request:j()(g()().mark(function u(){return g()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",{data:L||{}});case 1:case"end":return i.stop()}},u)})),params:{id:L==null?void 0:L.id},columns:ae})})]})};V.default=Y}}]);
