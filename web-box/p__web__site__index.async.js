"use strict";(self.webpackChunkapps_ant_admin=self.webpackChunkapps_ant_admin||[]).push([[462],{24936:function(ge,W,e){var N=e(73193),I=e.n(N),k=e(97190),h=e(44194),z=e(31549),D=function(A){var Y=A.modalVisible,J=A.children;return(0,z.jsx)(k.Z,I()(I()({destroyOnClose:!0,title:"\u65B0\u5EFA",width:"80vw",open:Y,footer:null},A),{},{children:J}))};W.Z=D},61158:function(ge,W,e){e.r(W),e.d(W,{default:function(){return Qe}});var N=e(45332),I=e.n(N),k=e(90819),h=e.n(k),z=e(89933),D=e.n(z),ee=e(24936),A=e(4977),Y=e.n(A),J=e(78796),pe=e.n(J),me=e(41553),be=e.n(me),ye=e(49488),Ce=e.n(ye),Se=e(84047),Te=e.n(Se),je=e(10154),Ie=e.n(je),Pe=e(99338),xe=function(y){Ce()(a,y);var u=Te()(a);function a(){var r;return pe()(this,a),r=u.call(this,"HashDB"),Ie()(be()(r),"hash",void 0),r.version(1).stores({hash:"&hash"}),r}return Y()(a)}(Pe.ZP),M=new xe,Ee=function(){var y=D()(h()().mark(function u(){return h()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:case"end":return r.stop()}},u)}));return function(){return y.apply(this,arguments)}}();M.on("populate",Ee),window.hashDb=M;var re=e(51264),De=function(){var y=D()(h()().mark(function u(a){var r,l,s,m,c=arguments;return h()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=c.length>1&&c[1]!==void 0?c[1]:"img",t.next=3,M.hash.get(a);case 3:if(l=t.sent,l!=null&&l.base64){t.next=14;break}return t.next=7,(0,re.I)({path:"hash/".concat(r,"/").concat(a),autoCreate:!1});case 7:if(s=t.sent,!s.success){t.next=13;break}return m=s.data.content,t.next=12,M.hash.put({hash:a,base64:m});case 12:return t.abrupt("return",{status:200,success:!0,data:m});case 13:return t.abrupt("return",s);case 14:return t.abrupt("return",{status:200,success:!0,data:l.base64});case 15:case"end":return t.stop()}},u)}));return function(a){return y.apply(this,arguments)}}(),Be=function(){var y=D()(h()().mark(function u(a){var r,l,s,m,c;return h()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=a.hash,l=a.content,s=a.type,m=s===void 0?"img":s,t.next=3,M.hash.get(r);case 3:if(c=t.sent,c!=null&&c.hash){t.next=10;break}return t.next=7,M.hash.put({hash:r,base64:l});case 7:return t.next=9,(0,re.I)({path:"hash/".concat(m,"/").concat(r),content:l,autoCreate:!0});case 9:return t.abrupt("return",t.sent);case 10:return t.abrupt("return",{status:200,success:!0,data:c.base64});case 11:case"end":return t.stop()}},u)}));return function(a){return y.apply(this,arguments)}}(),Re=e(94e3),Fe=e(87660),ae=e(8053),G=e(25248),te=e(16478),Ze=e(34934),p=e(44194),n=e(31549),Oe=function(u){return new Promise(function(a,r){var l=new FileReader;l.readAsDataURL(u),l.onload=function(){return a(l.result)},l.onerror=function(s){return r(s)}})},we=function(u){var a=["image/jpeg","image/png","image/svg+xml"].includes(u.type);a||G.ZP.error("You can only upload JPG/PNG/SVG file!");var r=u.size/1024/1024<2;return r||G.ZP.error("Image must smaller than 2MB!"),!1},Le=function(u){var a=u.value,r=u.onChange,l=u.onlyPreview,s=(0,p.useState)(!1),m=I()(s,2),c=m[0],S=m[1],t=(0,p.useState)(),w=I()(t,2),b=w[0],E=w[1],R=function(){var C=D()(h()().mark(function P(T){var g,F;return h()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(!c){v.next=2;break}return v.abrupt("return");case 2:return S(!0),console.log("info",T),v.next=6,Oe(T.file.originFileObj||T.file);case 6:return g=v.sent,E(g),v.next=10,(0,ae.x5)(g);case 10:return F=v.sent,v.next=13,Be({hash:F,content:g});case 13:r==null||r(F),S(!1);case 15:case"end":return v.stop()}},P)}));return function(T){return C.apply(this,arguments)}}(),B=(0,n.jsxs)("button",{style:{border:0,background:"none"},type:"button",children:[c?(0,n.jsx)(Re.Z,{}):(0,n.jsx)(Fe.Z,{}),(0,n.jsx)("div",{style:{marginTop:8},children:"Upload"})]});return(0,p.useEffect)(function(){var C=function(){var P=D()(h()().mark(function T(){var g;return h()().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:if(a){j.next=2;break}return j.abrupt("return");case 2:return j.next=4,De(a);case 4:g=j.sent,g.success&&E(g.data);case 6:case"end":return j.stop()}},T)}));return function(){return P.apply(this,arguments)}}();C()},[a]),l?(0,n.jsx)(te.Z,{src:b,width:32}):(0,n.jsx)(Ze.Z,{name:"avatar",listType:"picture-card",className:"avatar-uploader",showUploadList:!1,openFileDialogOnClick:!b,beforeUpload:we,onChange:R,children:b?(0,n.jsx)(te.Z,{src:b}):B})},ne=Le,K=e(36704),Q=e(47934),Me=e(79412),se=e(96682),Ue=e(65590),ue=e(88539),Ae=e(99255),ie=e(20933),Ge=e(30280),X=e(34825),$e=e(73193),V=e.n($e),We=e(85045),Ke=e.n(We),$=e(92259),H=e(88251),Ve=e(9425),He=e(10034),le={cursor:"move",transition:"unset"},Ne=function(u){var a=u.tag,r=(0,H.nB)({id:a.id}),l=r.listeners,s=r.transform,m=r.transition,c=r.isDragging,S=r.setNodeRef,t=s?V()(V()({},le),{},{transform:"translate3d(".concat(s.x,"px, ").concat(s.y,"px, 0)"),transition:c?"unset":m}):le;return(0,n.jsx)(Ve.Z,V()(V()({style:t,ref:S},l),{},{children:a.text}))},ke=function(u){var a=u.data,r=u.disabled,l=a.tags,s=(0,p.useState)([{id:1,text:"Tag 1"},{id:2,text:"Tag 2"},{id:3,text:"Tag 3"}]),m=I()(s,2),c=m[0],S=m[1];(0,p.useEffect)(function(){var b=function(){var E=D()(h()().mark(function R(){var B,C,P,T,g,F,j,v;return h()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:B=[],C=!1,P=!1,d.prev=3,g=Ke()(l);case 5:return d.next=7,g.next();case 7:if(!(C=!(F=d.sent).done)){d.next=16;break}return j=F.value,d.next=11,Q.q.tag.get(j);case 11:v=d.sent,v&&B.push({id:v.id,text:v.title});case 13:C=!1,d.next=5;break;case 16:d.next=22;break;case 18:d.prev=18,d.t0=d.catch(3),P=!0,T=d.t0;case 22:if(d.prev=22,d.prev=23,!(C&&g.return!=null)){d.next=27;break}return d.next=27,g.return();case 27:if(d.prev=27,!P){d.next=30;break}throw T;case 30:return d.finish(27);case 31:return d.finish(22);case 32:S(B);case 33:case"end":return d.stop()}},R,null,[[3,18,22,32],[23,,27,31]])}));return function(){return E.apply(this,arguments)}}();b()},[l]);var t=(0,$.Dy)((0,$.VT)($.we)),w=function(E){var R=E.active,B=E.over;B&&R.id!==B.id&&S(function(C){var P=C.findIndex(function(g){return g.id===R.id}),T=C.findIndex(function(g){return g.id===B.id});return(0,H.Rp)(C,P,T)})};return(0,p.useEffect)(function(){if(l.length===c.length){var b=c.map(function(E){return E.id});b.join()!==l.join()&&K.O.web.update(a.id,{tags:b})}},[c,l,a]),(0,n.jsx)($.LB,{sensors:t,onDragEnd:w,collisionDetection:$.pE,children:(0,n.jsx)(H.Fo,{disabled:r,items:c,strategy:H.PG,children:(0,n.jsx)(He.Z,{gap:"4px 0",wrap:!0,children:c.map(function(b){return(0,n.jsx)(Ne,{tag:b},b.id)})})})})},ze=ke,Ye=function(){var y=D()(h()().mark(function u(a){var r;return h()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return r=G.ZP.loading("\u6B63\u5728\u6DFB\u52A0"),s.prev=1,s.next=4,K.O.web.put(a);case 4:return r(),G.ZP.success("\u6DFB\u52A0\u6210\u529F"),s.abrupt("return",!0);case 9:return s.prev=9,s.t0=s.catch(1),r(),G.ZP.error("\u6DFB\u52A0\u5931\u8D25\u8BF7\u91CD\u8BD5\uFF01"),s.abrupt("return",!1);case 14:case"end":return s.stop()}},u,null,[[1,9]])}));return function(a){return y.apply(this,arguments)}}(),Je=function(){var u=(0,X.yR)(function(){return K.O.web.toArray()},[]),a=(0,X.yR)(function(){return Q.q.tag.orderBy("order").toArray()},[]),r=(0,X.yR)(function(){return Q.q.group.orderBy("order").toArray()},[]),l=(0,p.useMemo)(function(){return r==null?void 0:r.map(function(i){return{title:i.title,value:"group-"+i.id,disabled:!0,children:a==null?void 0:a.filter(function(o){return o.group===i.id}).map(function(o){return{title:o.title,value:o.id}})}}).filter(function(i){var o;return(o=i.children)===null||o===void 0?void 0:o.length})},[a,r]),s=(0,p.useState)(!1),m=I()(s,2),c=m[0],S=m[1],t=(0,p.useState)(),w=I()(t,2),b=w[0],E=w[1],R=function(o){E(o),S(!0)};(0,p.useEffect)(function(){c||E(void 0)},[c]);var B=(0,p.useState)(!1),C=I()(B,2),P=C[0],T=C[1],g=function(o){T(o.target.checked)},F=(0,p.useState)(!1),j=I()(F,2),v=j[0],oe=j[1],d=function(o){oe(o.target.checked)};console.log("operateChecked",v);var Xe=(0,p.useState)(),de=I()(Xe,2),L=de[0],ce=de[1],q=(0,p.useRef)(),_=[{title:"id",dataIndex:"id",hideInTable:!0,hideInSearch:!0,formItemProps:{hidden:!0},fieldProps:{disabled:!0}},{title:"\u56FE\u6807",dataIndex:"icon",hideInSearch:!0,renderFormItem:function(){return(0,n.jsx)(ne,{})},render:function(o,f,x,Z,O){return(0,n.jsx)(ne,{value:f.icon,onlyPreview:!0})}},{title:"\u6807\u9898",dataIndex:"title",formItemProps:{rules:[{required:!0,message:"\u540D\u79F0\u4E3A\u5FC5\u586B\u9879"}]},render:function(o,f){return(0,n.jsx)("span",{className:"cursor-pointer",onClick:function(){return(0,ae.ZK)(f.url)},children:f.title})}},{title:"\u526F\u6807\u9898",dataIndex:"subTitle",hideInSearch:!0},{title:"\u7F51\u5740",dataIndex:"url",formItemProps:{rules:[{required:!0,message:"\u7F51\u5740\u4E3A\u5FC5\u586B\u9879"}]}},{title:"tags",dataIndex:"tags",valueType:"treeSelect",fieldProps:{treeData:l,multiple:!0,showSearch:!0,rules:[{required:!0,message:"tags\u5FC5\u586B\u9879"}]},render:function(o,f){return(0,n.jsx)(ze,{data:f,disabled:!P})}},{title:"\u5907\u6CE8",dataIndex:"remark",valueType:"textarea"},{title:"\u64CD\u4F5C",dataIndex:"option",valueType:"option",fixed:v?"right":!1,width:"160px",render:function(o,f){return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("a",{href:f.url,target:"_black",rel:"noreferrer",children:"\u8DF3\u8F6C"}),(0,n.jsx)(ue.Z,{type:"vertical"}),(0,n.jsx)("a",{onClick:function(){return R(f)},children:"\u7F16\u8F91"}),(0,n.jsx)(ue.Z,{type:"vertical"}),(0,n.jsx)("a",{onClick:function(){return ce(f)},children:"\u8BE6\u60C5"})]})}}];(0,p.useEffect)(function(){K.O.getCloudData()},[]);var qe=(0,p.useState)({}),fe=I()(qe,2),U=fe[0],ve=fe[1],_e=(0,p.useState)([]),he=I()(_e,2),er=he[0],rr=he[1];return(0,p.useEffect)(function(){var i=u||[],o=Object.keys(U);o.length&&o.forEach(function(f){switch(f){case"title":i=i.filter(function(x){var Z;return x.title.includes(U[f]||"")||((Z=x.subTitle)===null||Z===void 0?void 0:Z.includes(U[f]||""))});break;case"url":i=i.filter(function(x){return x.url.includes(U[f]||"")});break;case"tags":i=i.filter(function(x){var Z=U[f];return Z?Z.every(function(O){return x.tags.includes(O)}):!0});break;default:break}}),rr(i)},[u,U]),(0,n.jsxs)(Me._z,{children:[(0,n.jsx)(se.Z,{headerTitle:"\u67E5\u8BE2\u8868\u683C",actionRef:q,rowKey:"id",search:{labelWidth:80},scroll:{x:"max-content"},toolBarRender:function(){return[(0,n.jsx)(Ae.ZP,{type:"primary",onClick:function(){return S(!0)},children:"\u65B0\u5EFA"},"1"),(0,n.jsx)(ie.Z,{checked:P,onChange:g,children:"tag"}),(0,n.jsx)(ie.Z,{checked:v,onChange:d,children:"\u64CD\u4F5C"})]},options:{fullScreen:!0,reload:!1},dataSource:er,columns:_,onSubmit:ve,onReset:function(){return ve({})}},"".concat(v)),(0,n.jsx)(ee.Z,{title:b&&"\u7F16\u8F91 - ".concat(b.id),onCancel:function(){return S(!1)},modalVisible:c,children:(0,n.jsx)(se.Z,{onSubmit:function(){var i=D()(h()().mark(function o(f){var x;return h()().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return O.next=2,Ye(f);case 2:x=O.sent,x&&(S(!1),q.current&&q.current.reload());case 4:case"end":return O.stop()}},o)}));return function(o){return i.apply(this,arguments)}}(),rowKey:"id",type:"form",columns:_,form:{initialValues:b}})}),(0,n.jsx)(Ge.Z,{width:600,open:!!L,onClose:function(){ce(void 0)},closable:!0,children:L&&(0,n.jsx)(Ue.vY,{column:2,title:L.title,request:D()(h()().mark(function i(){return h()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.abrupt("return",{data:L||{}});case 1:case"end":return f.stop()}},i)})),params:{id:L==null?void 0:L.id},columns:_})})]})},Qe=Je}}]);
